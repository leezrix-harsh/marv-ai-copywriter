"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/ollama-ai-provider-v2";
exports.ids = ["vendor-chunks/ollama-ai-provider-v2"];
exports.modules = {

/***/ "(rsc)/./node_modules/ollama-ai-provider-v2/dist/index.mjs":
/*!***********************************************************!*\
  !*** ./node_modules/ollama-ai-provider-v2/dist/index.mjs ***!
  \***********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createOllama: () => (/* binding */ createOllama),\n/* harmony export */   ollama: () => (/* binding */ ollama)\n/* harmony export */ });\n/* harmony import */ var _ai_sdk_provider__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @ai-sdk/provider */ \"(rsc)/./node_modules/@ai-sdk/provider/dist/index.mjs\");\n/* harmony import */ var _ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @ai-sdk/provider-utils */ \"(rsc)/./node_modules/@ai-sdk/provider-utils/dist/index.mjs\");\n/* harmony import */ var zod_v4__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod/v4 */ \"(rsc)/./node_modules/zod/v4/index.js\");\n// src/ollama-provider.ts\n\n\n\n// src/completion/ollama-completion-language-model.ts\n\n\n\n// src/adaptors/convert-to-ollama-completion-prompt.ts\n\nfunction convertToOllamaCompletionPrompt({\n  prompt,\n  user = \"user\",\n  assistant = \"assistant\"\n}) {\n  let text = \"\";\n  if (prompt[0].role === \"system\") {\n    text += `${prompt[0].content}\n\n`;\n    prompt = prompt.slice(1);\n  }\n  for (const { role, content } of prompt) {\n    switch (role) {\n      case \"system\": {\n        throw new _ai_sdk_provider__WEBPACK_IMPORTED_MODULE_1__.InvalidPromptError({\n          message: \"Unexpected system message in prompt: ${content}\",\n          prompt\n        });\n      }\n      case \"user\": {\n        const userMessage = content.map((part) => {\n          switch (part.type) {\n            case \"text\": {\n              return part.text;\n            }\n          }\n        }).filter(Boolean).join(\"\");\n        text += `${user}:\n${userMessage}\n\n`;\n        break;\n      }\n      case \"assistant\": {\n        const assistantMessage = content.map((part) => {\n          switch (part.type) {\n            case \"text\": {\n              return part.text;\n            }\n            case \"tool-call\": {\n              throw new _ai_sdk_provider__WEBPACK_IMPORTED_MODULE_1__.UnsupportedFunctionalityError({\n                functionality: \"tool-call messages\"\n              });\n            }\n          }\n        }).join(\"\");\n        text += `${assistant}:\n${assistantMessage}\n\n`;\n        break;\n      }\n      case \"tool\": {\n        throw new _ai_sdk_provider__WEBPACK_IMPORTED_MODULE_1__.UnsupportedFunctionalityError({\n          functionality: \"tool messages\"\n        });\n      }\n      default: {\n        const _exhaustiveCheck = role;\n        throw new Error(`Unsupported role: ${_exhaustiveCheck}`);\n      }\n    }\n  }\n  text += `${assistant}:\n`;\n  return {\n    prompt: text,\n    stopSequences: [`\n${user}:`]\n  };\n}\n\n// src/adaptors/map-ollama-finish-reason.ts\nfunction mapOllamaFinishReason(finishReason) {\n  switch (finishReason) {\n    case \"stop\":\n      return {\n        raw: finishReason,\n        unified: \"stop\"\n      };\n    case \"length\":\n      return {\n        raw: finishReason,\n        unified: \"length\"\n      };\n    case \"content_filter\":\n      return {\n        raw: finishReason,\n        unified: \"content-filter\"\n      };\n    case \"function_call\":\n    case \"tool_calls\":\n      return {\n        raw: finishReason,\n        unified: \"tool-calls\"\n      };\n    default:\n      return {\n        raw: finishReason,\n        unified: \"other\"\n      };\n  }\n}\n\n// src/common/get-response-metadata.ts\nfunction getResponseMetadata({\n  model,\n  created_at\n}) {\n  return {\n    id: void 0,\n    modelId: model != null ? model : void 0,\n    timestamp: created_at != null ? new Date(created_at) : void 0\n  };\n}\n\n// src/common/ndjson-stream-handler.ts\n\nfunction createNdjsonStreamResponseHandler(schema) {\n  return async ({ response }) => {\n    const responseHeaders = (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.extractResponseHeaders)(response);\n    if (response.body == null) {\n      throw new Error(\"Response body is null\");\n    }\n    const reader = response.body.getReader();\n    const decoder = new TextDecoder();\n    let buffer = \"\";\n    const stream = new ReadableStream({\n      async pull(controller) {\n        while (true) {\n          const { done, value } = await reader.read();\n          if (done) {\n            if (buffer.trim()) {\n              try {\n                const parsed = JSON.parse(buffer.trim());\n                const validated = schema.parse(parsed);\n                controller.enqueue({ success: true, value: validated, rawValue: validated });\n              } catch (e) {\n              }\n            }\n            controller.close();\n            return;\n          }\n          buffer += decoder.decode(value, { stream: true });\n          const lines = buffer.split(\"\\n\");\n          buffer = lines.pop() || \"\";\n          for (const line of lines) {\n            const trimmedLine = line.trim();\n            if (trimmedLine) {\n              try {\n                const parsed = JSON.parse(trimmedLine);\n                const validated = schema.parse(parsed);\n                controller.enqueue({ success: true, value: validated, rawValue: validated });\n              } catch (error) {\n                console.warn(\"Failed to parse NDJSON line:\", error);\n              }\n            }\n          }\n        }\n      },\n      cancel() {\n        reader.cancel();\n      }\n    });\n    return {\n      responseHeaders,\n      value: stream\n    };\n  };\n}\n\n// src/completion/ollama-error.ts\n\n\nvar ollamaErrorDataSchema = zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.object({\n  error: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    message: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n    // The additional information below is handled loosely to support\n    // Ollama-compatible providers that have slightly different error\n    // responses:\n    type: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string().nullish(),\n    param: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.any().nullish(),\n    code: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.union([zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string(), zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number()]).nullish()\n  })\n});\nvar ollamaFailedResponseHandler = (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.createJsonErrorResponseHandler)({\n  errorSchema: ollamaErrorDataSchema,\n  errorToMessage: (data) => data.error.message\n});\n\n// src/completion/ollama-completion-language-model.ts\nvar ollamaCompletionProviderOptions = zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.object({\n  think: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.boolean().optional(),\n  user: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n  suffix: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n  echo: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.boolean().optional()\n});\nvar OllamaCompletionLanguageModel = class {\n  constructor(modelId, settings, config) {\n    this.specificationVersion = \"v3\";\n    this.defaultObjectGenerationMode = void 0;\n    this.supportsImageUrls = false;\n    this.supportedUrls = {\n      // No URLs are supported for completion models.\n    };\n    this.modelId = modelId;\n    this.settings = settings;\n    this.config = config;\n    this.provider = config.provider;\n  }\n  getArgs({\n    prompt,\n    maxOutputTokens,\n    temperature,\n    topP,\n    topK,\n    frequencyPenalty,\n    presencePenalty,\n    stopSequences: userStopSequences,\n    responseFormat,\n    tools,\n    toolChoice,\n    seed\n  }) {\n    const warnings = [];\n    if (topK != null) {\n      warnings.push({\n        type: \"unsupported\",\n        feature: \"topK\"\n      });\n    }\n    if (tools == null ? void 0 : tools.length) {\n      warnings.push({ type: \"unsupported\", feature: \"tools\" });\n    }\n    if (toolChoice != null) {\n      warnings.push({ type: \"unsupported\", feature: \"toolChoice\" });\n    }\n    if (responseFormat != null && responseFormat.type !== \"text\") {\n      warnings.push({\n        type: \"unsupported\",\n        feature: \"responseFormat (JSON)\"\n      });\n    }\n    const { prompt: completionPrompt, stopSequences } = convertToOllamaCompletionPrompt({ prompt });\n    const stop = [...stopSequences != null ? stopSequences : [], ...userStopSequences != null ? userStopSequences : []];\n    return {\n      args: {\n        // model id:\n        model: this.modelId,\n        // Ollama-supported settings:\n        user: this.settings.user,\n        think: this.settings.think,\n        // standardized settings:\n        max_tokens: maxOutputTokens,\n        temperature,\n        top_p: topP,\n        frequency_penalty: frequencyPenalty,\n        presence_penalty: presencePenalty,\n        stop,\n        // prompt:\n        prompt: completionPrompt,\n        // other settings:\n        suffix: this.settings.suffix,\n        echo: this.settings.echo,\n        stream: false\n        // always disabled for doGenerate\n      },\n      warnings\n    };\n  }\n  async doGenerate(options) {\n    var _a, _b;\n    const { args: body, warnings } = this.getArgs(options);\n    const {\n      responseHeaders,\n      value: response,\n      rawValue: rawResponse\n    } = await (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.postJsonToApi)({\n      url: this.config.url({\n        path: \"/generate\",\n        modelId: this.modelId\n      }),\n      headers: (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.combineHeaders)(this.config.headers(), options.headers),\n      body: { ...body, stream: false },\n      failedResponseHandler: ollamaFailedResponseHandler,\n      successfulResponseHandler: (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.createJsonResponseHandler)(\n        baseOllamaResponseSchema\n      ),\n      abortSignal: options.abortSignal,\n      fetch: this.config.fetch\n    });\n    const { prompt: rawPrompt, ...rawSettings } = body;\n    const typedResponse = response;\n    return {\n      content: [\n        {\n          type: \"text\",\n          text: typedResponse.response\n        }\n      ],\n      usage: {\n        inputTokens: {\n          total: (_a = typedResponse.prompt_eval_count) != null ? _a : 0,\n          noCache: void 0,\n          cacheRead: void 0,\n          cacheWrite: void 0\n        },\n        outputTokens: {\n          total: (_b = typedResponse.eval_count) != null ? _b : 0,\n          text: void 0,\n          reasoning: void 0\n        }\n      },\n      finishReason: mapOllamaFinishReason(\"stop\"),\n      request: { body: JSON.stringify(body) },\n      response: {\n        ...getResponseMetadata(typedResponse),\n        headers: responseHeaders,\n        body: rawResponse\n      },\n      warnings\n    };\n  }\n  async doStream(options) {\n    const { args, warnings } = this.getArgs(options);\n    const body = {\n      ...args,\n      stream: true\n    };\n    const { responseHeaders, value: response } = await (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.postJsonToApi)({\n      url: this.config.url({\n        path: \"/generate\",\n        modelId: this.modelId\n      }),\n      headers: (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.combineHeaders)(this.config.headers(), options.headers),\n      body,\n      failedResponseHandler: ollamaFailedResponseHandler,\n      successfulResponseHandler: createNdjsonStreamResponseHandler(\n        baseOllamaResponseSchema\n      ),\n      abortSignal: options.abortSignal,\n      fetch: this.config.fetch\n    });\n    const { prompt: rawPrompt, ...rawSettings } = args;\n    let finishReason = \"other\";\n    let usage = {\n      inputTokens: {\n        total: void 0,\n        noCache: void 0,\n        cacheRead: void 0,\n        cacheWrite: void 0\n      },\n      outputTokens: {\n        total: void 0,\n        text: void 0,\n        reasoning: void 0\n      }\n    };\n    let isFirstChunk = true;\n    let textStarted = false;\n    const textId = (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.generateId)();\n    return {\n      stream: response.pipeThrough(\n        new TransformStream({\n          transform(chunk, controller) {\n            if (!chunk.success) {\n              controller.enqueue({ type: \"error\", error: chunk.rawValue });\n              return;\n            }\n            const value = chunk.value;\n            if (\"error\" in value) {\n              finishReason = \"error\";\n              controller.enqueue({ type: \"error\", error: value.error });\n              return;\n            }\n            if (isFirstChunk) {\n              isFirstChunk = false;\n              controller.enqueue({\n                type: \"response-metadata\",\n                ...getResponseMetadata(value)\n              });\n            }\n            if (value.done) {\n              finishReason = \"stop\";\n            }\n            if (value.response != null) {\n              if (!textStarted) {\n                controller.enqueue({\n                  type: \"text-start\",\n                  id: textId\n                });\n                textStarted = true;\n              }\n              controller.enqueue({\n                type: \"text-delta\",\n                id: textId,\n                delta: value.response\n              });\n            }\n          },\n          flush(controller) {\n            if (textStarted) {\n              controller.enqueue({\n                type: \"text-end\",\n                id: textId\n              });\n            }\n            controller.enqueue({\n              type: \"finish\",\n              finishReason: mapOllamaFinishReason(finishReason),\n              usage\n            });\n          }\n        })\n      ),\n      request: { body: JSON.stringify(body) },\n      response: { headers: responseHeaders },\n      warnings\n    };\n  }\n};\nvar baseOllamaResponseSchema = zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.object({\n  model: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n  created_at: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n  response: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n  done: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.boolean(),\n  context: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.array(zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number()),\n  eval_count: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n  eval_duration: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n  load_duration: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n  total_duration: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n  prompt_eval_count: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n  prompt_eval_duration: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional()\n});\n\n// src/embedding/ollama-embedding-model.ts\n\n\n\nvar ollamaEmbeddingProviderOptions = zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.object({\n  dimensions: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n  truncate: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.boolean().optional(),\n  keepAlive: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string().optional()\n});\nvar OllamaEmbeddingModel = class {\n  constructor(modelId, settings, config) {\n    this.specificationVersion = \"v3\";\n    var _a, _b;\n    this.modelId = modelId;\n    this.settings = settings;\n    this.config = config;\n    this.provider = config.provider;\n    this.maxEmbeddingsPerCall = (_a = settings.maxEmbeddingsPerCall) != null ? _a : 2048;\n    this.supportsParallelCalls = (_b = settings.supportsParallelCalls) != null ? _b : true;\n  }\n  getArgs({\n    values\n  }) {\n    return {\n      // model id:\n      model: this.modelId,\n      input: values,\n      // advanced parameters:\n      dimensions: this.settings.dimensions,\n      truncate: this.settings.truncate,\n      keep_alive: this.settings.keepAlive\n    };\n  }\n  async doEmbed({\n    values,\n    headers,\n    abortSignal,\n    providerOptions\n  }) {\n    var _a, _b, _c;\n    if (this.maxEmbeddingsPerCall && values.length > this.maxEmbeddingsPerCall) {\n      throw new _ai_sdk_provider__WEBPACK_IMPORTED_MODULE_1__.TooManyEmbeddingValuesForCallError({\n        provider: this.provider,\n        modelId: this.modelId,\n        maxEmbeddingsPerCall: this.maxEmbeddingsPerCall,\n        values\n      });\n    }\n    const ollamaOptions = await (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.parseProviderOptions)({\n      provider: \"ollama\",\n      providerOptions,\n      schema: ollamaEmbeddingProviderOptions\n    });\n    const dimensions = (_a = ollamaOptions == null ? void 0 : ollamaOptions.dimensions) != null ? _a : this.settings.dimensions;\n    const truncate = (_b = ollamaOptions == null ? void 0 : ollamaOptions.truncate) != null ? _b : this.settings.truncate;\n    const keepAlive = (_c = ollamaOptions == null ? void 0 : ollamaOptions.keepAlive) != null ? _c : this.settings.keepAlive;\n    const body = {\n      model: this.modelId,\n      input: values\n    };\n    if (dimensions !== void 0) body.dimensions = dimensions;\n    if (truncate !== void 0) body.truncate = truncate;\n    if (keepAlive !== void 0) body.keep_alive = keepAlive;\n    const {\n      responseHeaders,\n      value: response,\n      rawValue\n    } = await (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.postJsonToApi)({\n      url: this.config.url({\n        path: \"/embed\",\n        modelId: this.modelId\n      }),\n      headers: (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.combineHeaders)(this.config.headers(), headers),\n      body: { ...body },\n      failedResponseHandler: ollamaFailedResponseHandler,\n      successfulResponseHandler: (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.createJsonResponseHandler)(\n        ollamaTextEmbeddingResponseSchema\n      ),\n      abortSignal,\n      fetch: this.config.fetch\n    });\n    const typedResponse = response;\n    return {\n      embeddings: typedResponse.embeddings.map((item) => item),\n      usage: { tokens: typedResponse.prompt_eval_count },\n      response: { headers: responseHeaders, body: rawValue },\n      warnings: []\n    };\n  }\n};\nvar ollamaTextEmbeddingResponseSchema = zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.object({\n  model: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n  embeddings: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.array(zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.array(zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number())),\n  total_duration: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number(),\n  load_duration: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number(),\n  prompt_eval_count: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number()\n});\n\n// src/responses/ollama-responses-language-model.ts\n\n\n// src/responses/ollama-responses-processor.ts\n\n\nvar baseOllamaResponseSchema2 = zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.object({\n  model: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n  created_at: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n  done: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.boolean(),\n  message: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    content: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n    role: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n    thinking: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    tool_calls: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.array(\n      zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.object({\n        function: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.object({\n          name: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string(),\n          arguments: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.record(zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string(), zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.any())\n        }),\n        id: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string().optional()\n      })\n    ).optional().nullable()\n  }),\n  done_reason: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n  eval_count: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n  eval_duration: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n  load_duration: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n  prompt_eval_count: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n  prompt_eval_duration: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n  total_duration: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional()\n});\nvar OllamaResponseProcessor = class {\n  constructor(config) {\n    this.config = config;\n  }\n  processGenerateResponse(response) {\n    const content = this.extractContent(response);\n    const finishReason = mapOllamaFinishReason(response.done_reason);\n    const usage = this.extractUsage(response);\n    const providerMetadata = { ollama: {} };\n    return {\n      content,\n      finishReason,\n      usage,\n      providerMetadata\n    };\n  }\n  extractContent(response) {\n    var _a, _b, _c, _d, _e;\n    const content = [];\n    const text = response.message.content;\n    if (text != null && text.length > 0) {\n      content.push({\n        type: \"text\",\n        text\n      });\n    }\n    const thinking = response.message.thinking;\n    if (thinking != null && thinking.length > 0) {\n      content.push({\n        type: \"reasoning\",\n        text: thinking\n      });\n    }\n    for (const toolCall of (_a = response.message.tool_calls) != null ? _a : []) {\n      content.push({\n        type: \"tool-call\",\n        toolCallId: (_e = toolCall.id) != null ? _e : (_d = (_c = (_b = this.config).generateId) == null ? void 0 : _c.call(_b)) != null ? _d : (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.generateId)(),\n        toolName: toolCall.function.name,\n        input: JSON.stringify(toolCall.function.arguments)\n      });\n    }\n    return content;\n  }\n  extractUsage(response) {\n    var _a, _b;\n    return {\n      inputTokens: {\n        total: (_a = response.prompt_eval_count) != null ? _a : 0,\n        noCache: void 0,\n        cacheRead: void 0,\n        cacheWrite: void 0\n      },\n      outputTokens: {\n        total: (_b = response.eval_count) != null ? _b : 0,\n        text: void 0,\n        reasoning: void 0\n      }\n    };\n  }\n};\nfunction extractOllamaResponseObjectsFromChunk(chunk) {\n  var _a;\n  if (chunk.success) {\n    return [chunk.value];\n  }\n  const results = [];\n  const raw = (_a = chunk.error) == null ? void 0 : _a.text;\n  if (typeof raw !== \"string\" || raw.length === 0) {\n    return results;\n  }\n  const lines = raw.split(/\\r?\\n/);\n  for (const line of lines) {\n    const trimmed = line.trim();\n    if (trimmed === \"\") continue;\n    try {\n      const parsed = JSON.parse(trimmed);\n      const validated = baseOllamaResponseSchema2.safeParse(parsed);\n      if (validated.success) {\n        results.push(validated.data);\n      }\n    } catch (e) {\n    }\n  }\n  return results;\n}\n\n// src/responses/ollama-responses-request-builder.ts\n\n\n// src/adaptors/convert-to-ollama-chat-messages.ts\nfunction convertToOllamaChatMessages({\n  prompt,\n  systemMessageMode = \"system\"\n}) {\n  const messages = [];\n  for (const { role, content } of prompt) {\n    switch (role) {\n      case \"system\": {\n        switch (systemMessageMode) {\n          case \"system\": {\n            messages.push({ role: \"system\", content });\n            break;\n          }\n          case \"developer\": {\n            messages.push({ role: \"developer\", content });\n            break;\n          }\n          case \"remove\": {\n            break;\n          }\n          default: {\n            const _exhaustiveCheck = systemMessageMode;\n            throw new Error(\n              `Unsupported system message mode: ${_exhaustiveCheck}`\n            );\n          }\n        }\n        break;\n      }\n      case \"user\": {\n        if (content.length === 1 && content[0].type === \"text\") {\n          messages.push({ role: \"user\", content: content[0].text });\n          break;\n        }\n        const userText = content.filter((part) => part.type === \"text\").map((part) => part.text).join(\"\");\n        const images = content.filter((part) => part.type === \"file\" && part.mediaType.startsWith(\"image/\")).map((part) => part.data);\n        messages.push({\n          role: \"user\",\n          content: userText.length > 0 ? userText : [],\n          images: images.length > 0 ? images : void 0\n        });\n        break;\n      }\n      case \"assistant\": {\n        let text = \"\";\n        let thinking = \"\";\n        const toolCalls = [];\n        for (const part of content) {\n          switch (part.type) {\n            case \"text\": {\n              text += part.text;\n              break;\n            }\n            case \"tool-call\": {\n              toolCalls.push({\n                id: part.toolCallId,\n                type: \"function\",\n                function: {\n                  name: part.toolName,\n                  arguments: part.input\n                }\n              });\n              break;\n            }\n            case \"reasoning\": {\n              thinking += part.text;\n              break;\n            }\n            default: {\n              throw new Error(`Unsupported part: ${part}`);\n            }\n          }\n        }\n        messages.push({\n          role: \"assistant\",\n          content: text,\n          ...thinking && { thinking },\n          tool_calls: toolCalls.length > 0 ? toolCalls : void 0\n        });\n        break;\n      }\n      case \"tool\": {\n        for (const toolResponse of content) {\n          const output = toolResponse.output;\n          let contentValue;\n          switch (output.type) {\n            case \"text\":\n            case \"error-text\":\n              contentValue = output.value;\n              break;\n            case \"content\":\n            case \"json\":\n            case \"error-json\":\n              contentValue = JSON.stringify(output.value);\n              break;\n          }\n          messages.push({\n            role: \"tool\",\n            tool_call_id: toolResponse.toolCallId,\n            content: contentValue\n          });\n        }\n        break;\n      }\n      default: {\n        const _exhaustiveCheck = role;\n        throw new Error(`Unsupported role: ${_exhaustiveCheck}`);\n      }\n    }\n  }\n  return messages;\n}\n\n// src/ollama-chat-settings.ts\n\nvar ollamaProviderOptions = zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.object({\n  /**\n   * Enable or disable the model's thinking process. When enabled, the output will separate\n   * the model's thinking from the model's output. When disabled, the model will not think\n   * and directly output the content.\n   *\n   * Only supported by certain models like DeepSeek R1 and Qwen 3.\n   */\n  think: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.boolean().optional(),\n  options: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    num_ctx: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n    repeat_last_n: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n    repeat_penalty: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n    temperature: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n    seed: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n    stop: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.array(zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.string()).optional(),\n    num_predict: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n    top_k: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n    top_p: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional(),\n    min_p: zod_v4__WEBPACK_IMPORTED_MODULE_0__.z.number().optional()\n  }).optional()\n});\n\n// src/responses/convert-to-ollama-responses-messages.ts\n\nfunction convertToOllamaResponsesMessages({\n  prompt,\n  systemMessageMode\n}) {\n  const messages = [];\n  const warnings = [];\n  for (const { role, content } of prompt) {\n    switch (role) {\n      case \"system\": {\n        switch (systemMessageMode) {\n          case \"system\": {\n            messages.push({ role: \"system\", content });\n            break;\n          }\n          case \"developer\": {\n            messages.push({ role: \"developer\", content });\n            break;\n          }\n          case \"remove\": {\n            warnings.push({\n              type: \"other\",\n              message: \"system messages are removed for this model\"\n            });\n            break;\n          }\n          default: {\n            const _exhaustiveCheck = systemMessageMode;\n            throw new Error(\n              `Unsupported system message mode: ${_exhaustiveCheck}`\n            );\n          }\n        }\n        break;\n      }\n      case \"user\": {\n        messages.push({\n          role: \"user\",\n          content: content.map((part, index) => {\n            var _a, _b, _c;\n            switch (part.type) {\n              case \"text\": {\n                return { type: \"input_text\", text: part.text };\n              }\n              case \"file\": {\n                if (part.mediaType.startsWith(\"image/\")) {\n                  const mediaType = part.mediaType === \"image/*\" ? \"image/jpeg\" : part.mediaType;\n                  return {\n                    type: \"input_image\",\n                    image_url: part.data instanceof URL ? part.data.toString() : `data:${mediaType};base64,${part.data}`,\n                    // Ollama specific extension: image detail\n                    detail: (_b = (_a = part.providerOptions) == null ? void 0 : _a.ollama) == null ? void 0 : _b.imageDetail\n                  };\n                } else if (part.mediaType === \"application/pdf\") {\n                  if (part.data instanceof URL) {\n                    throw new _ai_sdk_provider__WEBPACK_IMPORTED_MODULE_1__.UnsupportedFunctionalityError({\n                      functionality: \"PDF file parts with URLs\"\n                    });\n                  }\n                  return {\n                    type: \"input_file\",\n                    filename: (_c = part.filename) != null ? _c : `part-${index}.pdf`,\n                    file_data: `data:application/pdf;base64,${part.data}`\n                  };\n                } else {\n                  throw new _ai_sdk_provider__WEBPACK_IMPORTED_MODULE_1__.UnsupportedFunctionalityError({\n                    functionality: `file part media type ${part.mediaType}`\n                  });\n                }\n              }\n            }\n          })\n        });\n        break;\n      }\n      case \"assistant\": {\n        for (const part of content) {\n          switch (part.type) {\n            case \"text\": {\n              messages.push({\n                role: \"assistant\",\n                content: [{ type: \"output_text\", text: part.text }]\n              });\n              break;\n            }\n            case \"tool-call\": {\n              if (part.providerExecuted) {\n                break;\n              }\n              messages.push({\n                type: \"function_call\",\n                call_id: part.toolCallId,\n                name: part.toolName,\n                arguments: JSON.stringify(part.input)\n              });\n              break;\n            }\n            case \"tool-result\": {\n              warnings.push({\n                type: \"other\",\n                message: `tool result parts in assistant messages are not supported for Ollama responses`\n              });\n              break;\n            }\n          }\n        }\n        break;\n      }\n      case \"tool\": {\n        for (const part of content) {\n          const output = part.output;\n          let contentValue;\n          switch (output.type) {\n            case \"text\":\n            case \"error-text\":\n              contentValue = output.value;\n              break;\n            case \"content\":\n            case \"json\":\n            case \"error-json\":\n              contentValue = JSON.stringify(output.value);\n              break;\n          }\n          messages.push({\n            type: \"function_call_output\",\n            call_id: part.toolCallId,\n            output: contentValue\n          });\n        }\n        break;\n      }\n      default: {\n        const _exhaustiveCheck = role;\n        throw new Error(`Unsupported role: ${_exhaustiveCheck}`);\n      }\n    }\n  }\n  return { messages, warnings };\n}\n\n// src/responses/ollama-responses-prepare-tools.ts\n\nfunction prepareResponsesTools({\n  tools,\n  toolChoice\n}) {\n  tools = (tools == null ? void 0 : tools.length) ? tools : void 0;\n  const toolWarnings = [];\n  if (tools == null) {\n    return { tools: void 0, toolChoice: void 0, toolWarnings };\n  }\n  const ollamaTools = [];\n  for (const tool of tools) {\n    switch (tool.type) {\n      case \"function\": {\n        let parameters = tool.inputSchema;\n        if (!parameters) {\n          parameters = {\n            type: \"object\",\n            properties: {},\n            required: []\n          };\n        } else if (parameters && typeof parameters === \"object\" && parameters.type === \"object\" && parameters.properties && Object.keys(parameters.properties).length === 0) {\n          parameters = {\n            ...parameters,\n            properties: {},\n            required: []\n          };\n        }\n        ollamaTools.push({\n          type: \"function\",\n          function: {\n            name: tool.name,\n            description: tool.description,\n            parameters\n          }\n        });\n        break;\n      }\n      default:\n        toolWarnings.push({ type: \"unsupported\", feature: \"tool\", details: tool.name });\n        break;\n    }\n  }\n  if (toolChoice == null) {\n    return { tools: ollamaTools, toolChoice: void 0, toolWarnings };\n  }\n  const type = toolChoice.type;\n  switch (type) {\n    case \"auto\":\n    case \"none\":\n    case \"required\":\n      return { tools: ollamaTools, toolChoice: type, toolWarnings };\n    case \"tool\":\n      return {\n        tools: ollamaTools,\n        toolChoice: toolChoice.toolName == \"web_search_preview\" ? { type: \"web_search_preview\" } : { type: \"function\", name: toolChoice.toolName },\n        toolWarnings\n      };\n    default: {\n      const _exhaustiveCheck = type;\n      throw new _ai_sdk_provider__WEBPACK_IMPORTED_MODULE_1__.UnsupportedFunctionalityError({\n        functionality: `tool choice type: ${_exhaustiveCheck}`\n      });\n    }\n  }\n}\n\n// src/responses/ollama-responses-request-builder.ts\nvar OllamaRequestBuilder = class {\n  async buildRequest({\n    modelId,\n    maxOutputTokens,\n    temperature,\n    stopSequences,\n    topP,\n    topK,\n    presencePenalty,\n    frequencyPenalty,\n    seed,\n    prompt,\n    providerOptions,\n    tools,\n    toolChoice,\n    responseFormat\n  }) {\n    const warnings = this.collectUnsupportedSettingsWarnings({\n      topK,\n      seed,\n      presencePenalty,\n      frequencyPenalty,\n      stopSequences\n    });\n    const { messages, warnings: messageWarnings } = convertToOllamaResponsesMessages({\n      prompt,\n      systemMessageMode: \"system\"\n    });\n    warnings.push(...messageWarnings);\n    const ollamaOptions = await this.parseProviderOptions(providerOptions);\n    const baseArgs = this.buildBaseArgs({\n      modelId,\n      prompt,\n      temperature,\n      topP,\n      maxOutputTokens,\n      responseFormat,\n      ollamaOptions\n    });\n    const { tools: ollamaTools, toolChoice: ollamaToolChoice, toolWarnings } = prepareResponsesTools({\n      tools,\n      toolChoice\n    });\n    return {\n      args: {\n        ...baseArgs,\n        tools: ollamaTools,\n        tool_choice: ollamaToolChoice\n      },\n      warnings: [...warnings, ...toolWarnings]\n    };\n  }\n  collectUnsupportedSettingsWarnings({\n    topK,\n    seed,\n    presencePenalty,\n    frequencyPenalty,\n    stopSequences\n  }) {\n    const warnings = [];\n    const unsupportedSettings = [\n      { value: topK, name: \"topK\" },\n      { value: seed, name: \"seed\" },\n      { value: presencePenalty, name: \"presencePenalty\" },\n      { value: frequencyPenalty, name: \"frequencyPenalty\" },\n      { value: stopSequences, name: \"stopSequences\" }\n    ];\n    for (const { value, name } of unsupportedSettings) {\n      if (value != null) {\n        warnings.push({ type: \"unsupported\", feature: \"setting\", details: name });\n      }\n    }\n    return warnings;\n  }\n  async parseProviderOptions(providerOptions) {\n    const result = await (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.parseProviderOptions)({\n      provider: \"ollama\",\n      providerOptions,\n      schema: ollamaProviderOptions\n    });\n    return result != null ? result : null;\n  }\n  buildBaseArgs({\n    modelId,\n    prompt,\n    temperature,\n    topP,\n    maxOutputTokens,\n    responseFormat,\n    ollamaOptions\n  }) {\n    var _a, _b;\n    return {\n      model: modelId,\n      messages: convertToOllamaChatMessages({\n        prompt,\n        systemMessageMode: \"system\"\n      }),\n      temperature,\n      top_p: topP,\n      max_output_tokens: maxOutputTokens,\n      ...(responseFormat == null ? void 0 : responseFormat.type) === \"json\" && {\n        format: responseFormat.schema != null ? responseFormat.schema : \"json\"\n      },\n      think: (_a = ollamaOptions == null ? void 0 : ollamaOptions.think) != null ? _a : false,\n      options: (_b = ollamaOptions == null ? void 0 : ollamaOptions.options) != null ? _b : void 0\n    };\n  }\n};\n\n// src/responses/ollama-responses-stream-processor.ts\n\n\nvar OllamaStreamProcessor = class {\n  constructor(config) {\n    this.config = config;\n    this.state = this.initializeState();\n  }\n  createTransformStream(warnings, options) {\n    return new TransformStream({\n      transform: (chunk, controller) => {\n        this.processChunk(chunk, controller, options);\n      },\n      flush: (controller) => {\n        this.finalizeStream(controller);\n      }\n    });\n  }\n  initializeState() {\n    return {\n      finishReason: {\n        unified: \"other\",\n        raw: void 0\n      },\n      usage: {\n        inputTokens: {\n          total: void 0,\n          noCache: void 0,\n          cacheRead: void 0,\n          cacheWrite: void 0\n        },\n        outputTokens: {\n          total: void 0,\n          text: void 0,\n          reasoning: void 0\n        }\n      },\n      responseId: null,\n      ongoingToolCalls: {},\n      hasToolCalls: false,\n      isFirstChunk: true,\n      hasTextStarted: false,\n      hasReasoningStarted: false,\n      textEnded: false,\n      reasoningEnded: false,\n      textId: (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.generateId)(),\n      reasoningId: (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.generateId)()\n    };\n  }\n  processChunk(chunk, controller, options) {\n    if (options == null ? void 0 : options.includeRawChunks) {\n      controller.enqueue({ type: \"raw\", rawValue: chunk.rawValue });\n    }\n    const values = extractOllamaResponseObjectsFromChunk(chunk);\n    if (values.length === 0) {\n      if (!chunk.success) {\n        this.state.finishReason = { unified: \"error\", raw: void 0 };\n        controller.enqueue({ type: \"error\", error: chunk.error });\n      }\n      return;\n    }\n    for (const value of values) {\n      this.processResponseValue(value, controller);\n    }\n  }\n  processResponseValue(value, controller) {\n    if (value && typeof value === \"object\" && \"error\" in value) {\n      this.state.finishReason = { unified: \"error\", raw: void 0 };\n      controller.enqueue({ type: \"error\", error: value.error });\n      return;\n    }\n    if (this.state.isFirstChunk) {\n      this.state.isFirstChunk = false;\n      controller.enqueue({\n        type: \"response-metadata\",\n        ...getResponseMetadata(value)\n      });\n    }\n    if (value.done) {\n      this.handleDoneChunk(value, controller);\n    }\n    const delta = value == null ? void 0 : value.message;\n    if (delta) {\n      this.processDelta(delta, controller);\n    }\n  }\n  handleDoneChunk(value, controller) {\n    this.state.finishReason = mapOllamaFinishReason(value.done_reason);\n    this.state.usage = {\n      inputTokens: {\n        total: value.prompt_eval_count || 0,\n        noCache: void 0,\n        cacheRead: void 0,\n        cacheWrite: void 0\n      },\n      outputTokens: {\n        total: value.eval_count || 0,\n        text: void 0,\n        reasoning: void 0\n      }\n    };\n    if (this.state.hasTextStarted && !this.state.textEnded) {\n      controller.enqueue({ type: \"text-end\", id: this.state.textId });\n      this.state.textEnded = true;\n    }\n    if (this.state.hasReasoningStarted && !this.state.reasoningEnded) {\n      controller.enqueue({ type: \"reasoning-end\", id: this.state.reasoningId });\n      this.state.reasoningEnded = true;\n    }\n  }\n  processDelta(delta, controller) {\n    this.processTextContent(delta, controller);\n    this.processThinking(delta, controller);\n    this.processToolCalls(delta, controller);\n  }\n  processTextContent(delta, controller) {\n    if ((delta == null ? void 0 : delta.content) != null) {\n      if (!this.state.hasTextStarted) {\n        controller.enqueue({ type: \"text-start\", id: this.state.textId });\n        this.state.hasTextStarted = true;\n      }\n      controller.enqueue({\n        type: \"text-delta\",\n        id: this.state.textId,\n        delta: delta.content\n      });\n    }\n  }\n  processThinking(delta, controller) {\n    if (delta == null ? void 0 : delta.thinking) {\n      if (!this.state.hasReasoningStarted) {\n        controller.enqueue({ type: \"reasoning-start\", id: this.state.reasoningId });\n        this.state.hasReasoningStarted = true;\n      }\n      controller.enqueue({\n        type: \"reasoning-delta\",\n        id: this.state.reasoningId,\n        delta: delta.thinking\n      });\n    }\n  }\n  processToolCalls(delta, controller) {\n    var _a, _b, _c, _d;\n    for (const toolCall of (_a = delta.tool_calls) != null ? _a : []) {\n      if (((_b = toolCall.function) == null ? void 0 : _b.name) == null) {\n        throw new _ai_sdk_provider__WEBPACK_IMPORTED_MODULE_1__.InvalidResponseDataError({\n          data: toolCall,\n          message: `Expected 'function.name' to be a string.`\n        });\n      }\n      if (((_c = toolCall.function) == null ? void 0 : _c.name) != null && ((_d = toolCall.function) == null ? void 0 : _d.arguments) != null) {\n        this.emitToolCall(toolCall, controller);\n      }\n    }\n  }\n  emitToolCall(toolCall, controller) {\n    var _a, _b, _c, _d;\n    const id = (_d = toolCall.id) != null ? _d : (_c = (_b = (_a = this.config).generateId) == null ? void 0 : _b.call(_a)) != null ? _c : (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.generateId)();\n    controller.enqueue({\n      type: \"tool-input-start\",\n      id,\n      toolName: toolCall.function.name\n    });\n    controller.enqueue({\n      type: \"tool-input-delta\",\n      id,\n      delta: JSON.stringify(toolCall.function.arguments)\n    });\n    controller.enqueue({\n      type: \"tool-input-end\",\n      id\n    });\n    controller.enqueue({\n      type: \"tool-call\",\n      toolCallId: id,\n      toolName: toolCall.function.name,\n      input: JSON.stringify(toolCall.function.arguments)\n    });\n    this.state.hasToolCalls = true;\n  }\n  finalizeStream(controller) {\n    if (this.state.hasTextStarted && !this.state.textEnded) {\n      controller.enqueue({ type: \"text-end\", id: this.state.textId });\n    }\n    if (this.state.hasReasoningStarted && !this.state.reasoningEnded) {\n      controller.enqueue({ type: \"reasoning-end\", id: this.state.reasoningId });\n    }\n    controller.enqueue({\n      type: \"finish\",\n      finishReason: this.state.finishReason,\n      usage: this.state.usage,\n      providerMetadata: {\n        ollama: {\n          responseId: this.state.responseId\n        }\n      }\n    });\n  }\n};\n\n// src/responses/ollama-responses-language-model.ts\nvar OllamaResponsesLanguageModel = class {\n  constructor(modelId, config) {\n    this.specificationVersion = \"v3\";\n    this.defaultObjectGenerationMode = void 0;\n    this.supportsImageUrls = true;\n    this.supportedUrls = {\n      \"image/*\": [\n        /^https?:\\/\\/.*$/\n      ]\n    };\n    this.modelId = modelId;\n    this.config = config;\n    this.provider = config.provider;\n    this.requestBuilder = new OllamaRequestBuilder();\n    this.responseProcessor = new OllamaResponseProcessor(config);\n  }\n  async doGenerate(options) {\n    const { args: body, warnings } = await this.prepareRequest(options);\n    const {\n      responseHeaders,\n      value: response,\n      rawValue: rawResponse\n    } = await (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.postJsonToApi)({\n      url: this.config.url({\n        path: \"/chat\",\n        modelId: this.modelId\n      }),\n      headers: (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.combineHeaders)(this.config.headers(), options.headers),\n      body: { ...body, stream: false },\n      failedResponseHandler: ollamaFailedResponseHandler,\n      successfulResponseHandler: (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.createJsonResponseHandler)(baseOllamaResponseSchema2),\n      abortSignal: options.abortSignal,\n      fetch: this.config.fetch\n    });\n    const processedResponse = this.responseProcessor.processGenerateResponse(response);\n    return {\n      ...processedResponse,\n      request: { body: JSON.stringify(body) },\n      response: {\n        modelId: this.modelId,\n        timestamp: /* @__PURE__ */ new Date(),\n        headers: responseHeaders,\n        body: rawResponse\n      },\n      warnings\n    };\n  }\n  async doStream(options) {\n    const { args: body, warnings } = await this.prepareRequest(options);\n    const { responseHeaders, value: response } = await (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.postJsonToApi)({\n      url: this.config.url({\n        path: \"/chat\",\n        modelId: this.modelId\n      }),\n      headers: (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.combineHeaders)(this.config.headers(), options.headers),\n      body: { ...body, stream: true },\n      failedResponseHandler: ollamaFailedResponseHandler,\n      successfulResponseHandler: createNdjsonStreamResponseHandler(baseOllamaResponseSchema2),\n      abortSignal: options.abortSignal,\n      fetch: this.config.fetch\n    });\n    const streamProcessor = new OllamaStreamProcessor(this.config);\n    return {\n      stream: response.pipeThrough(\n        streamProcessor.createTransformStream(warnings, options)\n      ),\n      request: { body },\n      response: { headers: responseHeaders },\n      warnings\n    };\n  }\n  async prepareRequest(options) {\n    return await this.requestBuilder.buildRequest({\n      modelId: this.modelId,\n      ...options\n    });\n  }\n};\n\n// src/ollama-provider.ts\nfunction createOllama(options = {}) {\n  var _a, _b;\n  const baseURL = (_a = (0,_ai_sdk_provider_utils__WEBPACK_IMPORTED_MODULE_2__.withoutTrailingSlash)(options.baseURL)) != null ? _a : \"http://127.0.0.1:11434/api\";\n  const providerName = (_b = options.name) != null ? _b : \"ollama\";\n  const getHeaders = () => ({\n    \"Ollama-Organization\": options.organization,\n    \"Ollama-Project\": options.project,\n    ...options.headers\n  });\n  const createCompletionModel = (modelId, settings = {}) => new OllamaCompletionLanguageModel(modelId, settings, {\n    provider: `${providerName}.completion`,\n    url: ({ path }) => `${baseURL}${path}`,\n    headers: getHeaders,\n    fetch: options.fetch\n  });\n  const createEmbeddingModel = (modelId, settings = {}) => new OllamaEmbeddingModel(modelId, settings, {\n    provider: `${providerName}.embedding`,\n    url: ({ path }) => `${baseURL}${path}`,\n    headers: getHeaders,\n    fetch: options.fetch\n  });\n  const createLanguageModel = (modelId) => {\n    if (new.target) {\n      throw new Error(\n        \"The Ollama model function cannot be called with the new keyword.\"\n      );\n    }\n    return createResponsesModel(modelId);\n  };\n  const createResponsesModel = (modelId) => {\n    return new OllamaResponsesLanguageModel(modelId, {\n      provider: `${providerName}.responses`,\n      url: ({ path }) => `${baseURL}${path}`,\n      headers: getHeaders,\n      fetch: options.fetch\n    });\n  };\n  const provider = function(modelId) {\n    return createLanguageModel(modelId);\n  };\n  provider.specificationVersion = \"v3\";\n  provider.languageModel = createLanguageModel;\n  provider.chat = createLanguageModel;\n  provider.completion = createCompletionModel;\n  provider.embedding = createEmbeddingModel;\n  provider.textEmbedding = createEmbeddingModel;\n  provider.textEmbeddingModel = createEmbeddingModel;\n  provider.embeddingModel = createEmbeddingModel;\n  provider.imageModel = (modelId) => {\n    throw new _ai_sdk_provider__WEBPACK_IMPORTED_MODULE_1__.NoSuchModelError({\n      modelId,\n      modelType: \"imageModel\",\n      message: \"Image generation is unsupported with Ollama\"\n    });\n  };\n  return provider;\n}\nvar ollama = createOllama();\n\n//# sourceMappingURL=index.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvb2xsYW1hLWFpLXByb3ZpZGVyLXYyL2Rpc3QvaW5kZXgubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7QUFHMEI7QUFHTTs7QUFFaEM7QUFNZ0M7QUFDQzs7QUFFakM7QUFJMEI7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLGVBQWU7O0FBRWY7QUFDQTtBQUNBO0FBQ0EsZUFBZSxnQkFBZ0I7QUFDL0I7QUFDQTtBQUNBLGtCQUFrQixnRUFBa0I7QUFDcEMsMkRBQTJELFFBQVE7QUFDbkU7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxtQkFBbUIsS0FBSztBQUN4QixFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLDJFQUE2QjtBQUNyRDtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0EsU0FBUztBQUNULG1CQUFtQixVQUFVO0FBQzdCLEVBQUU7O0FBRUY7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsMkVBQTZCO0FBQy9DO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLDZDQUE2QyxpQkFBaUI7QUFDOUQ7QUFDQTtBQUNBO0FBQ0EsYUFBYSxVQUFVO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRSxLQUFLO0FBQ1A7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFD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QUNBO0FBQ0E7QUFDQSxZQUFZLHVCQUF1QjtBQUNuQyxZQUFZLG1DQUFtQyxRQUFRLHFFQUFjO0FBQ3JFO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxlQUFlLHNFQUFlO0FBQzlCLGNBQWMsdUJBQXVCO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsTUFBTTtBQUN2QixrQkFBa0IsMEJBQTBCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQSxrQ0FBa0M7QUFDbEM7QUFDQSx3QkFBd0IsNEVBQW9CO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsdURBQXVEO0FBQ3ZELGlCQUFpQixhQUFhO0FBQzlCLFlBQVksTUFBTSxRQUFRLFFBQVEsRUFBRSxLQUFLO0FBQ3pDO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsc0RBQXNEO0FBQ3RELGlCQUFpQixhQUFhO0FBQzlCLFlBQVksTUFBTSxRQUFRLFFBQVEsRUFBRSxLQUFLO0FBQ3pDO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsYUFBYTtBQUNoQyxjQUFjLE1BQU0sUUFBUSxRQUFRLEVBQUUsS0FBSztBQUMzQztBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyw4REFBZ0I7QUFDOUI7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBSUU7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL21hcnYtYWktY29weXdyaXRlci8uL25vZGVfbW9kdWxlcy9vbGxhbWEtYWktcHJvdmlkZXItdjIvZGlzdC9pbmRleC5tanM/YzZmNCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvb2xsYW1hLXByb3ZpZGVyLnRzXG5pbXBvcnQge1xuICBOb1N1Y2hNb2RlbEVycm9yXG59IGZyb20gXCJAYWktc2RrL3Byb3ZpZGVyXCI7XG5pbXBvcnQge1xuICB3aXRob3V0VHJhaWxpbmdTbGFzaFxufSBmcm9tIFwiQGFpLXNkay9wcm92aWRlci11dGlsc1wiO1xuXG4vLyBzcmMvY29tcGxldGlvbi9vbGxhbWEtY29tcGxldGlvbi1sYW5ndWFnZS1tb2RlbC50c1xuaW1wb3J0IHtcbiAgY29tYmluZUhlYWRlcnMsXG4gIGNyZWF0ZUpzb25SZXNwb25zZUhhbmRsZXIsXG4gIGdlbmVyYXRlSWQsXG4gIHBvc3RKc29uVG9BcGlcbn0gZnJvbSBcIkBhaS1zZGsvcHJvdmlkZXItdXRpbHNcIjtcbmltcG9ydCB7IHogYXMgejIgfSBmcm9tIFwiem9kL3Y0XCI7XG5cbi8vIHNyYy9hZGFwdG9ycy9jb252ZXJ0LXRvLW9sbGFtYS1jb21wbGV0aW9uLXByb21wdC50c1xuaW1wb3J0IHtcbiAgSW52YWxpZFByb21wdEVycm9yLFxuICBVbnN1cHBvcnRlZEZ1bmN0aW9uYWxpdHlFcnJvclxufSBmcm9tIFwiQGFpLXNkay9wcm92aWRlclwiO1xuZnVuY3Rpb24gY29udmVydFRvT2xsYW1hQ29tcGxldGlvblByb21wdCh7XG4gIHByb21wdCxcbiAgdXNlciA9IFwidXNlclwiLFxuICBhc3Npc3RhbnQgPSBcImFzc2lzdGFudFwiXG59KSB7XG4gIGxldCB0ZXh0ID0gXCJcIjtcbiAgaWYgKHByb21wdFswXS5yb2xlID09PSBcInN5c3RlbVwiKSB7XG4gICAgdGV4dCArPSBgJHtwcm9tcHRbMF0uY29udGVudH1cblxuYDtcbiAgICBwcm9tcHQgPSBwcm9tcHQuc2xpY2UoMSk7XG4gIH1cbiAgZm9yIChjb25zdCB7IHJvbGUsIGNvbnRlbnQgfSBvZiBwcm9tcHQpIHtcbiAgICBzd2l0Y2ggKHJvbGUpIHtcbiAgICAgIGNhc2UgXCJzeXN0ZW1cIjoge1xuICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFByb21wdEVycm9yKHtcbiAgICAgICAgICBtZXNzYWdlOiBcIlVuZXhwZWN0ZWQgc3lzdGVtIG1lc3NhZ2UgaW4gcHJvbXB0OiAke2NvbnRlbnR9XCIsXG4gICAgICAgICAgcHJvbXB0XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY2FzZSBcInVzZXJcIjoge1xuICAgICAgICBjb25zdCB1c2VyTWVzc2FnZSA9IGNvbnRlbnQubWFwKChwYXJ0KSA9PiB7XG4gICAgICAgICAgc3dpdGNoIChwYXJ0LnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJ0ZXh0XCI6IHtcbiAgICAgICAgICAgICAgcmV0dXJuIHBhcnQudGV4dDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pLmZpbHRlcihCb29sZWFuKS5qb2luKFwiXCIpO1xuICAgICAgICB0ZXh0ICs9IGAke3VzZXJ9OlxuJHt1c2VyTWVzc2FnZX1cblxuYDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYXNzaXN0YW50XCI6IHtcbiAgICAgICAgY29uc3QgYXNzaXN0YW50TWVzc2FnZSA9IGNvbnRlbnQubWFwKChwYXJ0KSA9PiB7XG4gICAgICAgICAgc3dpdGNoIChwYXJ0LnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJ0ZXh0XCI6IHtcbiAgICAgICAgICAgICAgcmV0dXJuIHBhcnQudGV4dDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgXCJ0b29sLWNhbGxcIjoge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRGdW5jdGlvbmFsaXR5RXJyb3Ioe1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uYWxpdHk6IFwidG9vbC1jYWxsIG1lc3NhZ2VzXCJcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KS5qb2luKFwiXCIpO1xuICAgICAgICB0ZXh0ICs9IGAke2Fzc2lzdGFudH06XG4ke2Fzc2lzdGFudE1lc3NhZ2V9XG5cbmA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcInRvb2xcIjoge1xuICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRGdW5jdGlvbmFsaXR5RXJyb3Ioe1xuICAgICAgICAgIGZ1bmN0aW9uYWxpdHk6IFwidG9vbCBtZXNzYWdlc1wiXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICBjb25zdCBfZXhoYXVzdGl2ZUNoZWNrID0gcm9sZTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCByb2xlOiAke19leGhhdXN0aXZlQ2hlY2t9YCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHRleHQgKz0gYCR7YXNzaXN0YW50fTpcbmA7XG4gIHJldHVybiB7XG4gICAgcHJvbXB0OiB0ZXh0LFxuICAgIHN0b3BTZXF1ZW5jZXM6IFtgXG4ke3VzZXJ9OmBdXG4gIH07XG59XG5cbi8vIHNyYy9hZGFwdG9ycy9tYXAtb2xsYW1hLWZpbmlzaC1yZWFzb24udHNcbmZ1bmN0aW9uIG1hcE9sbGFtYUZpbmlzaFJlYXNvbihmaW5pc2hSZWFzb24pIHtcbiAgc3dpdGNoIChmaW5pc2hSZWFzb24pIHtcbiAgICBjYXNlIFwic3RvcFwiOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmF3OiBmaW5pc2hSZWFzb24sXG4gICAgICAgIHVuaWZpZWQ6IFwic3RvcFwiXG4gICAgICB9O1xuICAgIGNhc2UgXCJsZW5ndGhcIjpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJhdzogZmluaXNoUmVhc29uLFxuICAgICAgICB1bmlmaWVkOiBcImxlbmd0aFwiXG4gICAgICB9O1xuICAgIGNhc2UgXCJjb250ZW50X2ZpbHRlclwiOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmF3OiBmaW5pc2hSZWFzb24sXG4gICAgICAgIHVuaWZpZWQ6IFwiY29udGVudC1maWx0ZXJcIlxuICAgICAgfTtcbiAgICBjYXNlIFwiZnVuY3Rpb25fY2FsbFwiOlxuICAgIGNhc2UgXCJ0b29sX2NhbGxzXCI6XG4gICAgICByZXR1cm4ge1xuICAgICAgICByYXc6IGZpbmlzaFJlYXNvbixcbiAgICAgICAgdW5pZmllZDogXCJ0b29sLWNhbGxzXCJcbiAgICAgIH07XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJhdzogZmluaXNoUmVhc29uLFxuICAgICAgICB1bmlmaWVkOiBcIm90aGVyXCJcbiAgICAgIH07XG4gIH1cbn1cblxuLy8gc3JjL2NvbW1vbi9nZXQtcmVzcG9uc2UtbWV0YWRhdGEudHNcbmZ1bmN0aW9uIGdldFJlc3BvbnNlTWV0YWRhdGEoe1xuICBtb2RlbCxcbiAgY3JlYXRlZF9hdFxufSkge1xuICByZXR1cm4ge1xuICAgIGlkOiB2b2lkIDAsXG4gICAgbW9kZWxJZDogbW9kZWwgIT0gbnVsbCA/IG1vZGVsIDogdm9pZCAwLFxuICAgIHRpbWVzdGFtcDogY3JlYXRlZF9hdCAhPSBudWxsID8gbmV3IERhdGUoY3JlYXRlZF9hdCkgOiB2b2lkIDBcbiAgfTtcbn1cblxuLy8gc3JjL2NvbW1vbi9uZGpzb24tc3RyZWFtLWhhbmRsZXIudHNcbmltcG9ydCB7IGV4dHJhY3RSZXNwb25zZUhlYWRlcnMgfSBmcm9tIFwiQGFpLXNkay9wcm92aWRlci11dGlsc1wiO1xuZnVuY3Rpb24gY3JlYXRlTmRqc29uU3RyZWFtUmVzcG9uc2VIYW5kbGVyKHNjaGVtYSkge1xuICByZXR1cm4gYXN5bmMgKHsgcmVzcG9uc2UgfSkgPT4ge1xuICAgIGNvbnN0IHJlc3BvbnNlSGVhZGVycyA9IGV4dHJhY3RSZXNwb25zZUhlYWRlcnMocmVzcG9uc2UpO1xuICAgIGlmIChyZXNwb25zZS5ib2R5ID09IG51bGwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlJlc3BvbnNlIGJvZHkgaXMgbnVsbFwiKTtcbiAgICB9XG4gICAgY29uc3QgcmVhZGVyID0gcmVzcG9uc2UuYm9keS5nZXRSZWFkZXIoKTtcbiAgICBjb25zdCBkZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCk7XG4gICAgbGV0IGJ1ZmZlciA9IFwiXCI7XG4gICAgY29uc3Qgc3RyZWFtID0gbmV3IFJlYWRhYmxlU3RyZWFtKHtcbiAgICAgIGFzeW5jIHB1bGwoY29udHJvbGxlcikge1xuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgIGNvbnN0IHsgZG9uZSwgdmFsdWUgfSA9IGF3YWl0IHJlYWRlci5yZWFkKCk7XG4gICAgICAgICAgaWYgKGRvbmUpIHtcbiAgICAgICAgICAgIGlmIChidWZmZXIudHJpbSgpKSB7XG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZShidWZmZXIudHJpbSgpKTtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWxpZGF0ZWQgPSBzY2hlbWEucGFyc2UocGFyc2VkKTtcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyLmVucXVldWUoeyBzdWNjZXNzOiB0cnVlLCB2YWx1ZTogdmFsaWRhdGVkLCByYXdWYWx1ZTogdmFsaWRhdGVkIH0pO1xuICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnRyb2xsZXIuY2xvc2UoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnVmZmVyICs9IGRlY29kZXIuZGVjb2RlKHZhbHVlLCB7IHN0cmVhbTogdHJ1ZSB9KTtcbiAgICAgICAgICBjb25zdCBsaW5lcyA9IGJ1ZmZlci5zcGxpdChcIlxcblwiKTtcbiAgICAgICAgICBidWZmZXIgPSBsaW5lcy5wb3AoKSB8fCBcIlwiO1xuICAgICAgICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgICAgICAgY29uc3QgdHJpbW1lZExpbmUgPSBsaW5lLnRyaW0oKTtcbiAgICAgICAgICAgIGlmICh0cmltbWVkTGluZSkge1xuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UodHJpbW1lZExpbmUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkYXRlZCA9IHNjaGVtYS5wYXJzZShwYXJzZWQpO1xuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZSh7IHN1Y2Nlc3M6IHRydWUsIHZhbHVlOiB2YWxpZGF0ZWQsIHJhd1ZhbHVlOiB2YWxpZGF0ZWQgfSk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwiRmFpbGVkIHRvIHBhcnNlIE5ESlNPTiBsaW5lOlwiLCBlcnJvcik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBjYW5jZWwoKSB7XG4gICAgICAgIHJlYWRlci5jYW5jZWwoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4ge1xuICAgICAgcmVzcG9uc2VIZWFkZXJzLFxuICAgICAgdmFsdWU6IHN0cmVhbVxuICAgIH07XG4gIH07XG59XG5cbi8vIHNyYy9jb21wbGV0aW9uL29sbGFtYS1lcnJvci50c1xuaW1wb3J0IHsgY3JlYXRlSnNvbkVycm9yUmVzcG9uc2VIYW5kbGVyIH0gZnJvbSBcIkBhaS1zZGsvcHJvdmlkZXItdXRpbHNcIjtcbmltcG9ydCB7IHogfSBmcm9tIFwiem9kL3Y0XCI7XG52YXIgb2xsYW1hRXJyb3JEYXRhU2NoZW1hID0gei5vYmplY3Qoe1xuICBlcnJvcjogei5vYmplY3Qoe1xuICAgIG1lc3NhZ2U6IHouc3RyaW5nKCksXG4gICAgLy8gVGhlIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gYmVsb3cgaXMgaGFuZGxlZCBsb29zZWx5IHRvIHN1cHBvcnRcbiAgICAvLyBPbGxhbWEtY29tcGF0aWJsZSBwcm92aWRlcnMgdGhhdCBoYXZlIHNsaWdodGx5IGRpZmZlcmVudCBlcnJvclxuICAgIC8vIHJlc3BvbnNlczpcbiAgICB0eXBlOiB6LnN0cmluZygpLm51bGxpc2goKSxcbiAgICBwYXJhbTogei5hbnkoKS5udWxsaXNoKCksXG4gICAgY29kZTogei51bmlvbihbei5zdHJpbmcoKSwgei5udW1iZXIoKV0pLm51bGxpc2goKVxuICB9KVxufSk7XG52YXIgb2xsYW1hRmFpbGVkUmVzcG9uc2VIYW5kbGVyID0gY3JlYXRlSnNvbkVycm9yUmVzcG9uc2VIYW5kbGVyKHtcbiAgZXJyb3JTY2hlbWE6IG9sbGFtYUVycm9yRGF0YVNjaGVtYSxcbiAgZXJyb3JUb01lc3NhZ2U6IChkYXRhKSA9PiBkYXRhLmVycm9yLm1lc3NhZ2Vcbn0pO1xuXG4vLyBzcmMvY29tcGxldGlvbi9vbGxhbWEtY29tcGxldGlvbi1sYW5ndWFnZS1tb2RlbC50c1xudmFyIG9sbGFtYUNvbXBsZXRpb25Qcm92aWRlck9wdGlvbnMgPSB6Mi5vYmplY3Qoe1xuICB0aGluazogejIuYm9vbGVhbigpLm9wdGlvbmFsKCksXG4gIHVzZXI6IHoyLnN0cmluZygpLm9wdGlvbmFsKCksXG4gIHN1ZmZpeDogejIuc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgZWNobzogejIuYm9vbGVhbigpLm9wdGlvbmFsKClcbn0pO1xudmFyIE9sbGFtYUNvbXBsZXRpb25MYW5ndWFnZU1vZGVsID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihtb2RlbElkLCBzZXR0aW5ncywgY29uZmlnKSB7XG4gICAgdGhpcy5zcGVjaWZpY2F0aW9uVmVyc2lvbiA9IFwidjNcIjtcbiAgICB0aGlzLmRlZmF1bHRPYmplY3RHZW5lcmF0aW9uTW9kZSA9IHZvaWQgMDtcbiAgICB0aGlzLnN1cHBvcnRzSW1hZ2VVcmxzID0gZmFsc2U7XG4gICAgdGhpcy5zdXBwb3J0ZWRVcmxzID0ge1xuICAgICAgLy8gTm8gVVJMcyBhcmUgc3VwcG9ydGVkIGZvciBjb21wbGV0aW9uIG1vZGVscy5cbiAgICB9O1xuICAgIHRoaXMubW9kZWxJZCA9IG1vZGVsSWQ7XG4gICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMucHJvdmlkZXIgPSBjb25maWcucHJvdmlkZXI7XG4gIH1cbiAgZ2V0QXJncyh7XG4gICAgcHJvbXB0LFxuICAgIG1heE91dHB1dFRva2VucyxcbiAgICB0ZW1wZXJhdHVyZSxcbiAgICB0b3BQLFxuICAgIHRvcEssXG4gICAgZnJlcXVlbmN5UGVuYWx0eSxcbiAgICBwcmVzZW5jZVBlbmFsdHksXG4gICAgc3RvcFNlcXVlbmNlczogdXNlclN0b3BTZXF1ZW5jZXMsXG4gICAgcmVzcG9uc2VGb3JtYXQsXG4gICAgdG9vbHMsXG4gICAgdG9vbENob2ljZSxcbiAgICBzZWVkXG4gIH0pIHtcbiAgICBjb25zdCB3YXJuaW5ncyA9IFtdO1xuICAgIGlmICh0b3BLICE9IG51bGwpIHtcbiAgICAgIHdhcm5pbmdzLnB1c2goe1xuICAgICAgICB0eXBlOiBcInVuc3VwcG9ydGVkXCIsXG4gICAgICAgIGZlYXR1cmU6IFwidG9wS1wiXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHRvb2xzID09IG51bGwgPyB2b2lkIDAgOiB0b29scy5sZW5ndGgpIHtcbiAgICAgIHdhcm5pbmdzLnB1c2goeyB0eXBlOiBcInVuc3VwcG9ydGVkXCIsIGZlYXR1cmU6IFwidG9vbHNcIiB9KTtcbiAgICB9XG4gICAgaWYgKHRvb2xDaG9pY2UgIT0gbnVsbCkge1xuICAgICAgd2FybmluZ3MucHVzaCh7IHR5cGU6IFwidW5zdXBwb3J0ZWRcIiwgZmVhdHVyZTogXCJ0b29sQ2hvaWNlXCIgfSk7XG4gICAgfVxuICAgIGlmIChyZXNwb25zZUZvcm1hdCAhPSBudWxsICYmIHJlc3BvbnNlRm9ybWF0LnR5cGUgIT09IFwidGV4dFwiKSB7XG4gICAgICB3YXJuaW5ncy5wdXNoKHtcbiAgICAgICAgdHlwZTogXCJ1bnN1cHBvcnRlZFwiLFxuICAgICAgICBmZWF0dXJlOiBcInJlc3BvbnNlRm9ybWF0IChKU09OKVwiXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgeyBwcm9tcHQ6IGNvbXBsZXRpb25Qcm9tcHQsIHN0b3BTZXF1ZW5jZXMgfSA9IGNvbnZlcnRUb09sbGFtYUNvbXBsZXRpb25Qcm9tcHQoeyBwcm9tcHQgfSk7XG4gICAgY29uc3Qgc3RvcCA9IFsuLi5zdG9wU2VxdWVuY2VzICE9IG51bGwgPyBzdG9wU2VxdWVuY2VzIDogW10sIC4uLnVzZXJTdG9wU2VxdWVuY2VzICE9IG51bGwgPyB1c2VyU3RvcFNlcXVlbmNlcyA6IFtdXTtcbiAgICByZXR1cm4ge1xuICAgICAgYXJnczoge1xuICAgICAgICAvLyBtb2RlbCBpZDpcbiAgICAgICAgbW9kZWw6IHRoaXMubW9kZWxJZCxcbiAgICAgICAgLy8gT2xsYW1hLXN1cHBvcnRlZCBzZXR0aW5nczpcbiAgICAgICAgdXNlcjogdGhpcy5zZXR0aW5ncy51c2VyLFxuICAgICAgICB0aGluazogdGhpcy5zZXR0aW5ncy50aGluayxcbiAgICAgICAgLy8gc3RhbmRhcmRpemVkIHNldHRpbmdzOlxuICAgICAgICBtYXhfdG9rZW5zOiBtYXhPdXRwdXRUb2tlbnMsXG4gICAgICAgIHRlbXBlcmF0dXJlLFxuICAgICAgICB0b3BfcDogdG9wUCxcbiAgICAgICAgZnJlcXVlbmN5X3BlbmFsdHk6IGZyZXF1ZW5jeVBlbmFsdHksXG4gICAgICAgIHByZXNlbmNlX3BlbmFsdHk6IHByZXNlbmNlUGVuYWx0eSxcbiAgICAgICAgc3RvcCxcbiAgICAgICAgLy8gcHJvbXB0OlxuICAgICAgICBwcm9tcHQ6IGNvbXBsZXRpb25Qcm9tcHQsXG4gICAgICAgIC8vIG90aGVyIHNldHRpbmdzOlxuICAgICAgICBzdWZmaXg6IHRoaXMuc2V0dGluZ3Muc3VmZml4LFxuICAgICAgICBlY2hvOiB0aGlzLnNldHRpbmdzLmVjaG8sXG4gICAgICAgIHN0cmVhbTogZmFsc2VcbiAgICAgICAgLy8gYWx3YXlzIGRpc2FibGVkIGZvciBkb0dlbmVyYXRlXG4gICAgICB9LFxuICAgICAgd2FybmluZ3NcbiAgICB9O1xuICB9XG4gIGFzeW5jIGRvR2VuZXJhdGUob3B0aW9ucykge1xuICAgIHZhciBfYSwgX2I7XG4gICAgY29uc3QgeyBhcmdzOiBib2R5LCB3YXJuaW5ncyB9ID0gdGhpcy5nZXRBcmdzKG9wdGlvbnMpO1xuICAgIGNvbnN0IHtcbiAgICAgIHJlc3BvbnNlSGVhZGVycyxcbiAgICAgIHZhbHVlOiByZXNwb25zZSxcbiAgICAgIHJhd1ZhbHVlOiByYXdSZXNwb25zZVxuICAgIH0gPSBhd2FpdCBwb3N0SnNvblRvQXBpKHtcbiAgICAgIHVybDogdGhpcy5jb25maWcudXJsKHtcbiAgICAgICAgcGF0aDogXCIvZ2VuZXJhdGVcIixcbiAgICAgICAgbW9kZWxJZDogdGhpcy5tb2RlbElkXG4gICAgICB9KSxcbiAgICAgIGhlYWRlcnM6IGNvbWJpbmVIZWFkZXJzKHRoaXMuY29uZmlnLmhlYWRlcnMoKSwgb3B0aW9ucy5oZWFkZXJzKSxcbiAgICAgIGJvZHk6IHsgLi4uYm9keSwgc3RyZWFtOiBmYWxzZSB9LFxuICAgICAgZmFpbGVkUmVzcG9uc2VIYW5kbGVyOiBvbGxhbWFGYWlsZWRSZXNwb25zZUhhbmRsZXIsXG4gICAgICBzdWNjZXNzZnVsUmVzcG9uc2VIYW5kbGVyOiBjcmVhdGVKc29uUmVzcG9uc2VIYW5kbGVyKFxuICAgICAgICBiYXNlT2xsYW1hUmVzcG9uc2VTY2hlbWFcbiAgICAgICksXG4gICAgICBhYm9ydFNpZ25hbDogb3B0aW9ucy5hYm9ydFNpZ25hbCxcbiAgICAgIGZldGNoOiB0aGlzLmNvbmZpZy5mZXRjaFxuICAgIH0pO1xuICAgIGNvbnN0IHsgcHJvbXB0OiByYXdQcm9tcHQsIC4uLnJhd1NldHRpbmdzIH0gPSBib2R5O1xuICAgIGNvbnN0IHR5cGVkUmVzcG9uc2UgPSByZXNwb25zZTtcbiAgICByZXR1cm4ge1xuICAgICAgY29udGVudDogW1xuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgICAgdGV4dDogdHlwZWRSZXNwb25zZS5yZXNwb25zZVxuICAgICAgICB9XG4gICAgICBdLFxuICAgICAgdXNhZ2U6IHtcbiAgICAgICAgaW5wdXRUb2tlbnM6IHtcbiAgICAgICAgICB0b3RhbDogKF9hID0gdHlwZWRSZXNwb25zZS5wcm9tcHRfZXZhbF9jb3VudCkgIT0gbnVsbCA/IF9hIDogMCxcbiAgICAgICAgICBub0NhY2hlOiB2b2lkIDAsXG4gICAgICAgICAgY2FjaGVSZWFkOiB2b2lkIDAsXG4gICAgICAgICAgY2FjaGVXcml0ZTogdm9pZCAwXG4gICAgICAgIH0sXG4gICAgICAgIG91dHB1dFRva2Vuczoge1xuICAgICAgICAgIHRvdGFsOiAoX2IgPSB0eXBlZFJlc3BvbnNlLmV2YWxfY291bnQpICE9IG51bGwgPyBfYiA6IDAsXG4gICAgICAgICAgdGV4dDogdm9pZCAwLFxuICAgICAgICAgIHJlYXNvbmluZzogdm9pZCAwXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBmaW5pc2hSZWFzb246IG1hcE9sbGFtYUZpbmlzaFJlYXNvbihcInN0b3BcIiksXG4gICAgICByZXF1ZXN0OiB7IGJvZHk6IEpTT04uc3RyaW5naWZ5KGJvZHkpIH0sXG4gICAgICByZXNwb25zZToge1xuICAgICAgICAuLi5nZXRSZXNwb25zZU1ldGFkYXRhKHR5cGVkUmVzcG9uc2UpLFxuICAgICAgICBoZWFkZXJzOiByZXNwb25zZUhlYWRlcnMsXG4gICAgICAgIGJvZHk6IHJhd1Jlc3BvbnNlXG4gICAgICB9LFxuICAgICAgd2FybmluZ3NcbiAgICB9O1xuICB9XG4gIGFzeW5jIGRvU3RyZWFtKG9wdGlvbnMpIHtcbiAgICBjb25zdCB7IGFyZ3MsIHdhcm5pbmdzIH0gPSB0aGlzLmdldEFyZ3Mob3B0aW9ucyk7XG4gICAgY29uc3QgYm9keSA9IHtcbiAgICAgIC4uLmFyZ3MsXG4gICAgICBzdHJlYW06IHRydWVcbiAgICB9O1xuICAgIGNvbnN0IHsgcmVzcG9uc2VIZWFkZXJzLCB2YWx1ZTogcmVzcG9uc2UgfSA9IGF3YWl0IHBvc3RKc29uVG9BcGkoe1xuICAgICAgdXJsOiB0aGlzLmNvbmZpZy51cmwoe1xuICAgICAgICBwYXRoOiBcIi9nZW5lcmF0ZVwiLFxuICAgICAgICBtb2RlbElkOiB0aGlzLm1vZGVsSWRcbiAgICAgIH0pLFxuICAgICAgaGVhZGVyczogY29tYmluZUhlYWRlcnModGhpcy5jb25maWcuaGVhZGVycygpLCBvcHRpb25zLmhlYWRlcnMpLFxuICAgICAgYm9keSxcbiAgICAgIGZhaWxlZFJlc3BvbnNlSGFuZGxlcjogb2xsYW1hRmFpbGVkUmVzcG9uc2VIYW5kbGVyLFxuICAgICAgc3VjY2Vzc2Z1bFJlc3BvbnNlSGFuZGxlcjogY3JlYXRlTmRqc29uU3RyZWFtUmVzcG9uc2VIYW5kbGVyKFxuICAgICAgICBiYXNlT2xsYW1hUmVzcG9uc2VTY2hlbWFcbiAgICAgICksXG4gICAgICBhYm9ydFNpZ25hbDogb3B0aW9ucy5hYm9ydFNpZ25hbCxcbiAgICAgIGZldGNoOiB0aGlzLmNvbmZpZy5mZXRjaFxuICAgIH0pO1xuICAgIGNvbnN0IHsgcHJvbXB0OiByYXdQcm9tcHQsIC4uLnJhd1NldHRpbmdzIH0gPSBhcmdzO1xuICAgIGxldCBmaW5pc2hSZWFzb24gPSBcIm90aGVyXCI7XG4gICAgbGV0IHVzYWdlID0ge1xuICAgICAgaW5wdXRUb2tlbnM6IHtcbiAgICAgICAgdG90YWw6IHZvaWQgMCxcbiAgICAgICAgbm9DYWNoZTogdm9pZCAwLFxuICAgICAgICBjYWNoZVJlYWQ6IHZvaWQgMCxcbiAgICAgICAgY2FjaGVXcml0ZTogdm9pZCAwXG4gICAgICB9LFxuICAgICAgb3V0cHV0VG9rZW5zOiB7XG4gICAgICAgIHRvdGFsOiB2b2lkIDAsXG4gICAgICAgIHRleHQ6IHZvaWQgMCxcbiAgICAgICAgcmVhc29uaW5nOiB2b2lkIDBcbiAgICAgIH1cbiAgICB9O1xuICAgIGxldCBpc0ZpcnN0Q2h1bmsgPSB0cnVlO1xuICAgIGxldCB0ZXh0U3RhcnRlZCA9IGZhbHNlO1xuICAgIGNvbnN0IHRleHRJZCA9IGdlbmVyYXRlSWQoKTtcbiAgICByZXR1cm4ge1xuICAgICAgc3RyZWFtOiByZXNwb25zZS5waXBlVGhyb3VnaChcbiAgICAgICAgbmV3IFRyYW5zZm9ybVN0cmVhbSh7XG4gICAgICAgICAgdHJhbnNmb3JtKGNodW5rLCBjb250cm9sbGVyKSB7XG4gICAgICAgICAgICBpZiAoIWNodW5rLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgY29udHJvbGxlci5lbnF1ZXVlKHsgdHlwZTogXCJlcnJvclwiLCBlcnJvcjogY2h1bmsucmF3VmFsdWUgfSk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gY2h1bmsudmFsdWU7XG4gICAgICAgICAgICBpZiAoXCJlcnJvclwiIGluIHZhbHVlKSB7XG4gICAgICAgICAgICAgIGZpbmlzaFJlYXNvbiA9IFwiZXJyb3JcIjtcbiAgICAgICAgICAgICAgY29udHJvbGxlci5lbnF1ZXVlKHsgdHlwZTogXCJlcnJvclwiLCBlcnJvcjogdmFsdWUuZXJyb3IgfSk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc0ZpcnN0Q2h1bmspIHtcbiAgICAgICAgICAgICAgaXNGaXJzdENodW5rID0gZmFsc2U7XG4gICAgICAgICAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZSh7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJyZXNwb25zZS1tZXRhZGF0YVwiLFxuICAgICAgICAgICAgICAgIC4uLmdldFJlc3BvbnNlTWV0YWRhdGEodmFsdWUpXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHZhbHVlLmRvbmUpIHtcbiAgICAgICAgICAgICAgZmluaXNoUmVhc29uID0gXCJzdG9wXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodmFsdWUucmVzcG9uc2UgIT0gbnVsbCkge1xuICAgICAgICAgICAgICBpZiAoIXRleHRTdGFydGVkKSB7XG4gICAgICAgICAgICAgICAgY29udHJvbGxlci5lbnF1ZXVlKHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IFwidGV4dC1zdGFydFwiLFxuICAgICAgICAgICAgICAgICAgaWQ6IHRleHRJZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRleHRTdGFydGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjb250cm9sbGVyLmVucXVldWUoe1xuICAgICAgICAgICAgICAgIHR5cGU6IFwidGV4dC1kZWx0YVwiLFxuICAgICAgICAgICAgICAgIGlkOiB0ZXh0SWQsXG4gICAgICAgICAgICAgICAgZGVsdGE6IHZhbHVlLnJlc3BvbnNlXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZmx1c2goY29udHJvbGxlcikge1xuICAgICAgICAgICAgaWYgKHRleHRTdGFydGVkKSB7XG4gICAgICAgICAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZSh7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJ0ZXh0LWVuZFwiLFxuICAgICAgICAgICAgICAgIGlkOiB0ZXh0SWRcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb250cm9sbGVyLmVucXVldWUoe1xuICAgICAgICAgICAgICB0eXBlOiBcImZpbmlzaFwiLFxuICAgICAgICAgICAgICBmaW5pc2hSZWFzb246IG1hcE9sbGFtYUZpbmlzaFJlYXNvbihmaW5pc2hSZWFzb24pLFxuICAgICAgICAgICAgICB1c2FnZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgKSxcbiAgICAgIHJlcXVlc3Q6IHsgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSkgfSxcbiAgICAgIHJlc3BvbnNlOiB7IGhlYWRlcnM6IHJlc3BvbnNlSGVhZGVycyB9LFxuICAgICAgd2FybmluZ3NcbiAgICB9O1xuICB9XG59O1xudmFyIGJhc2VPbGxhbWFSZXNwb25zZVNjaGVtYSA9IHoyLm9iamVjdCh7XG4gIG1vZGVsOiB6Mi5zdHJpbmcoKSxcbiAgY3JlYXRlZF9hdDogejIuc3RyaW5nKCksXG4gIHJlc3BvbnNlOiB6Mi5zdHJpbmcoKSxcbiAgZG9uZTogejIuYm9vbGVhbigpLFxuICBjb250ZXh0OiB6Mi5hcnJheSh6Mi5udW1iZXIoKSksXG4gIGV2YWxfY291bnQ6IHoyLm51bWJlcigpLm9wdGlvbmFsKCksXG4gIGV2YWxfZHVyYXRpb246IHoyLm51bWJlcigpLm9wdGlvbmFsKCksXG4gIGxvYWRfZHVyYXRpb246IHoyLm51bWJlcigpLm9wdGlvbmFsKCksXG4gIHRvdGFsX2R1cmF0aW9uOiB6Mi5udW1iZXIoKS5vcHRpb25hbCgpLFxuICBwcm9tcHRfZXZhbF9jb3VudDogejIubnVtYmVyKCkub3B0aW9uYWwoKSxcbiAgcHJvbXB0X2V2YWxfZHVyYXRpb246IHoyLm51bWJlcigpLm9wdGlvbmFsKClcbn0pO1xuXG4vLyBzcmMvZW1iZWRkaW5nL29sbGFtYS1lbWJlZGRpbmctbW9kZWwudHNcbmltcG9ydCB7XG4gIFRvb01hbnlFbWJlZGRpbmdWYWx1ZXNGb3JDYWxsRXJyb3Jcbn0gZnJvbSBcIkBhaS1zZGsvcHJvdmlkZXJcIjtcbmltcG9ydCB7XG4gIGNvbWJpbmVIZWFkZXJzIGFzIGNvbWJpbmVIZWFkZXJzMixcbiAgY3JlYXRlSnNvblJlc3BvbnNlSGFuZGxlciBhcyBjcmVhdGVKc29uUmVzcG9uc2VIYW5kbGVyMixcbiAgcGFyc2VQcm92aWRlck9wdGlvbnMsXG4gIHBvc3RKc29uVG9BcGkgYXMgcG9zdEpzb25Ub0FwaTJcbn0gZnJvbSBcIkBhaS1zZGsvcHJvdmlkZXItdXRpbHNcIjtcbmltcG9ydCB7IHogYXMgejMgfSBmcm9tIFwiem9kL3Y0XCI7XG52YXIgb2xsYW1hRW1iZWRkaW5nUHJvdmlkZXJPcHRpb25zID0gejMub2JqZWN0KHtcbiAgZGltZW5zaW9uczogejMubnVtYmVyKCkub3B0aW9uYWwoKSxcbiAgdHJ1bmNhdGU6IHozLmJvb2xlYW4oKS5vcHRpb25hbCgpLFxuICBrZWVwQWxpdmU6IHozLnN0cmluZygpLm9wdGlvbmFsKClcbn0pO1xudmFyIE9sbGFtYUVtYmVkZGluZ01vZGVsID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihtb2RlbElkLCBzZXR0aW5ncywgY29uZmlnKSB7XG4gICAgdGhpcy5zcGVjaWZpY2F0aW9uVmVyc2lvbiA9IFwidjNcIjtcbiAgICB2YXIgX2EsIF9iO1xuICAgIHRoaXMubW9kZWxJZCA9IG1vZGVsSWQ7XG4gICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMucHJvdmlkZXIgPSBjb25maWcucHJvdmlkZXI7XG4gICAgdGhpcy5tYXhFbWJlZGRpbmdzUGVyQ2FsbCA9IChfYSA9IHNldHRpbmdzLm1heEVtYmVkZGluZ3NQZXJDYWxsKSAhPSBudWxsID8gX2EgOiAyMDQ4O1xuICAgIHRoaXMuc3VwcG9ydHNQYXJhbGxlbENhbGxzID0gKF9iID0gc2V0dGluZ3Muc3VwcG9ydHNQYXJhbGxlbENhbGxzKSAhPSBudWxsID8gX2IgOiB0cnVlO1xuICB9XG4gIGdldEFyZ3Moe1xuICAgIHZhbHVlc1xuICB9KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC8vIG1vZGVsIGlkOlxuICAgICAgbW9kZWw6IHRoaXMubW9kZWxJZCxcbiAgICAgIGlucHV0OiB2YWx1ZXMsXG4gICAgICAvLyBhZHZhbmNlZCBwYXJhbWV0ZXJzOlxuICAgICAgZGltZW5zaW9uczogdGhpcy5zZXR0aW5ncy5kaW1lbnNpb25zLFxuICAgICAgdHJ1bmNhdGU6IHRoaXMuc2V0dGluZ3MudHJ1bmNhdGUsXG4gICAgICBrZWVwX2FsaXZlOiB0aGlzLnNldHRpbmdzLmtlZXBBbGl2ZVxuICAgIH07XG4gIH1cbiAgYXN5bmMgZG9FbWJlZCh7XG4gICAgdmFsdWVzLFxuICAgIGhlYWRlcnMsXG4gICAgYWJvcnRTaWduYWwsXG4gICAgcHJvdmlkZXJPcHRpb25zXG4gIH0pIHtcbiAgICB2YXIgX2EsIF9iLCBfYztcbiAgICBpZiAodGhpcy5tYXhFbWJlZGRpbmdzUGVyQ2FsbCAmJiB2YWx1ZXMubGVuZ3RoID4gdGhpcy5tYXhFbWJlZGRpbmdzUGVyQ2FsbCkge1xuICAgICAgdGhyb3cgbmV3IFRvb01hbnlFbWJlZGRpbmdWYWx1ZXNGb3JDYWxsRXJyb3Ioe1xuICAgICAgICBwcm92aWRlcjogdGhpcy5wcm92aWRlcixcbiAgICAgICAgbW9kZWxJZDogdGhpcy5tb2RlbElkLFxuICAgICAgICBtYXhFbWJlZGRpbmdzUGVyQ2FsbDogdGhpcy5tYXhFbWJlZGRpbmdzUGVyQ2FsbCxcbiAgICAgICAgdmFsdWVzXG4gICAgICB9KTtcbiAgICB9XG4gICAgY29uc3Qgb2xsYW1hT3B0aW9ucyA9IGF3YWl0IHBhcnNlUHJvdmlkZXJPcHRpb25zKHtcbiAgICAgIHByb3ZpZGVyOiBcIm9sbGFtYVwiLFxuICAgICAgcHJvdmlkZXJPcHRpb25zLFxuICAgICAgc2NoZW1hOiBvbGxhbWFFbWJlZGRpbmdQcm92aWRlck9wdGlvbnNcbiAgICB9KTtcbiAgICBjb25zdCBkaW1lbnNpb25zID0gKF9hID0gb2xsYW1hT3B0aW9ucyA9PSBudWxsID8gdm9pZCAwIDogb2xsYW1hT3B0aW9ucy5kaW1lbnNpb25zKSAhPSBudWxsID8gX2EgOiB0aGlzLnNldHRpbmdzLmRpbWVuc2lvbnM7XG4gICAgY29uc3QgdHJ1bmNhdGUgPSAoX2IgPSBvbGxhbWFPcHRpb25zID09IG51bGwgPyB2b2lkIDAgOiBvbGxhbWFPcHRpb25zLnRydW5jYXRlKSAhPSBudWxsID8gX2IgOiB0aGlzLnNldHRpbmdzLnRydW5jYXRlO1xuICAgIGNvbnN0IGtlZXBBbGl2ZSA9IChfYyA9IG9sbGFtYU9wdGlvbnMgPT0gbnVsbCA/IHZvaWQgMCA6IG9sbGFtYU9wdGlvbnMua2VlcEFsaXZlKSAhPSBudWxsID8gX2MgOiB0aGlzLnNldHRpbmdzLmtlZXBBbGl2ZTtcbiAgICBjb25zdCBib2R5ID0ge1xuICAgICAgbW9kZWw6IHRoaXMubW9kZWxJZCxcbiAgICAgIGlucHV0OiB2YWx1ZXNcbiAgICB9O1xuICAgIGlmIChkaW1lbnNpb25zICE9PSB2b2lkIDApIGJvZHkuZGltZW5zaW9ucyA9IGRpbWVuc2lvbnM7XG4gICAgaWYgKHRydW5jYXRlICE9PSB2b2lkIDApIGJvZHkudHJ1bmNhdGUgPSB0cnVuY2F0ZTtcbiAgICBpZiAoa2VlcEFsaXZlICE9PSB2b2lkIDApIGJvZHkua2VlcF9hbGl2ZSA9IGtlZXBBbGl2ZTtcbiAgICBjb25zdCB7XG4gICAgICByZXNwb25zZUhlYWRlcnMsXG4gICAgICB2YWx1ZTogcmVzcG9uc2UsXG4gICAgICByYXdWYWx1ZVxuICAgIH0gPSBhd2FpdCBwb3N0SnNvblRvQXBpMih7XG4gICAgICB1cmw6IHRoaXMuY29uZmlnLnVybCh7XG4gICAgICAgIHBhdGg6IFwiL2VtYmVkXCIsXG4gICAgICAgIG1vZGVsSWQ6IHRoaXMubW9kZWxJZFxuICAgICAgfSksXG4gICAgICBoZWFkZXJzOiBjb21iaW5lSGVhZGVyczIodGhpcy5jb25maWcuaGVhZGVycygpLCBoZWFkZXJzKSxcbiAgICAgIGJvZHk6IHsgLi4uYm9keSB9LFxuICAgICAgZmFpbGVkUmVzcG9uc2VIYW5kbGVyOiBvbGxhbWFGYWlsZWRSZXNwb25zZUhhbmRsZXIsXG4gICAgICBzdWNjZXNzZnVsUmVzcG9uc2VIYW5kbGVyOiBjcmVhdGVKc29uUmVzcG9uc2VIYW5kbGVyMihcbiAgICAgICAgb2xsYW1hVGV4dEVtYmVkZGluZ1Jlc3BvbnNlU2NoZW1hXG4gICAgICApLFxuICAgICAgYWJvcnRTaWduYWwsXG4gICAgICBmZXRjaDogdGhpcy5jb25maWcuZmV0Y2hcbiAgICB9KTtcbiAgICBjb25zdCB0eXBlZFJlc3BvbnNlID0gcmVzcG9uc2U7XG4gICAgcmV0dXJuIHtcbiAgICAgIGVtYmVkZGluZ3M6IHR5cGVkUmVzcG9uc2UuZW1iZWRkaW5ncy5tYXAoKGl0ZW0pID0+IGl0ZW0pLFxuICAgICAgdXNhZ2U6IHsgdG9rZW5zOiB0eXBlZFJlc3BvbnNlLnByb21wdF9ldmFsX2NvdW50IH0sXG4gICAgICByZXNwb25zZTogeyBoZWFkZXJzOiByZXNwb25zZUhlYWRlcnMsIGJvZHk6IHJhd1ZhbHVlIH0sXG4gICAgICB3YXJuaW5nczogW11cbiAgICB9O1xuICB9XG59O1xudmFyIG9sbGFtYVRleHRFbWJlZGRpbmdSZXNwb25zZVNjaGVtYSA9IHozLm9iamVjdCh7XG4gIG1vZGVsOiB6My5zdHJpbmcoKSxcbiAgZW1iZWRkaW5nczogejMuYXJyYXkoejMuYXJyYXkoejMubnVtYmVyKCkpKSxcbiAgdG90YWxfZHVyYXRpb246IHozLm51bWJlcigpLFxuICBsb2FkX2R1cmF0aW9uOiB6My5udW1iZXIoKSxcbiAgcHJvbXB0X2V2YWxfY291bnQ6IHozLm51bWJlcigpXG59KTtcblxuLy8gc3JjL3Jlc3BvbnNlcy9vbGxhbWEtcmVzcG9uc2VzLWxhbmd1YWdlLW1vZGVsLnRzXG5pbXBvcnQge1xuICBjb21iaW5lSGVhZGVycyBhcyBjb21iaW5lSGVhZGVyczMsXG4gIGNyZWF0ZUpzb25SZXNwb25zZUhhbmRsZXIgYXMgY3JlYXRlSnNvblJlc3BvbnNlSGFuZGxlcjMsXG4gIHBvc3RKc29uVG9BcGkgYXMgcG9zdEpzb25Ub0FwaTNcbn0gZnJvbSBcIkBhaS1zZGsvcHJvdmlkZXItdXRpbHNcIjtcblxuLy8gc3JjL3Jlc3BvbnNlcy9vbGxhbWEtcmVzcG9uc2VzLXByb2Nlc3Nvci50c1xuaW1wb3J0IHsgZ2VuZXJhdGVJZCBhcyBnZW5lcmF0ZUlkMiB9IGZyb20gXCJAYWktc2RrL3Byb3ZpZGVyLXV0aWxzXCI7XG5pbXBvcnQgeyB6IGFzIHo0IH0gZnJvbSBcInpvZC92NFwiO1xudmFyIGJhc2VPbGxhbWFSZXNwb25zZVNjaGVtYTIgPSB6NC5vYmplY3Qoe1xuICBtb2RlbDogejQuc3RyaW5nKCksXG4gIGNyZWF0ZWRfYXQ6IHo0LnN0cmluZygpLFxuICBkb25lOiB6NC5ib29sZWFuKCksXG4gIG1lc3NhZ2U6IHo0Lm9iamVjdCh7XG4gICAgY29udGVudDogejQuc3RyaW5nKCksXG4gICAgcm9sZTogejQuc3RyaW5nKCksXG4gICAgdGhpbmtpbmc6IHo0LnN0cmluZygpLm9wdGlvbmFsKCksXG4gICAgdG9vbF9jYWxsczogejQuYXJyYXkoXG4gICAgICB6NC5vYmplY3Qoe1xuICAgICAgICBmdW5jdGlvbjogejQub2JqZWN0KHtcbiAgICAgICAgICBuYW1lOiB6NC5zdHJpbmcoKSxcbiAgICAgICAgICBhcmd1bWVudHM6IHo0LnJlY29yZCh6NC5zdHJpbmcoKSwgejQuYW55KCkpXG4gICAgICAgIH0pLFxuICAgICAgICBpZDogejQuc3RyaW5nKCkub3B0aW9uYWwoKVxuICAgICAgfSlcbiAgICApLm9wdGlvbmFsKCkubnVsbGFibGUoKVxuICB9KSxcbiAgZG9uZV9yZWFzb246IHo0LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIGV2YWxfY291bnQ6IHo0Lm51bWJlcigpLm9wdGlvbmFsKCksXG4gIGV2YWxfZHVyYXRpb246IHo0Lm51bWJlcigpLm9wdGlvbmFsKCksXG4gIGxvYWRfZHVyYXRpb246IHo0Lm51bWJlcigpLm9wdGlvbmFsKCksXG4gIHByb21wdF9ldmFsX2NvdW50OiB6NC5udW1iZXIoKS5vcHRpb25hbCgpLFxuICBwcm9tcHRfZXZhbF9kdXJhdGlvbjogejQubnVtYmVyKCkub3B0aW9uYWwoKSxcbiAgdG90YWxfZHVyYXRpb246IHo0Lm51bWJlcigpLm9wdGlvbmFsKClcbn0pO1xudmFyIE9sbGFtYVJlc3BvbnNlUHJvY2Vzc29yID0gY2xhc3Mge1xuICBjb25zdHJ1Y3Rvcihjb25maWcpIHtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgfVxuICBwcm9jZXNzR2VuZXJhdGVSZXNwb25zZShyZXNwb25zZSkge1xuICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLmV4dHJhY3RDb250ZW50KHJlc3BvbnNlKTtcbiAgICBjb25zdCBmaW5pc2hSZWFzb24gPSBtYXBPbGxhbWFGaW5pc2hSZWFzb24ocmVzcG9uc2UuZG9uZV9yZWFzb24pO1xuICAgIGNvbnN0IHVzYWdlID0gdGhpcy5leHRyYWN0VXNhZ2UocmVzcG9uc2UpO1xuICAgIGNvbnN0IHByb3ZpZGVyTWV0YWRhdGEgPSB7IG9sbGFtYToge30gfTtcbiAgICByZXR1cm4ge1xuICAgICAgY29udGVudCxcbiAgICAgIGZpbmlzaFJlYXNvbixcbiAgICAgIHVzYWdlLFxuICAgICAgcHJvdmlkZXJNZXRhZGF0YVxuICAgIH07XG4gIH1cbiAgZXh0cmFjdENvbnRlbnQocmVzcG9uc2UpIHtcbiAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lO1xuICAgIGNvbnN0IGNvbnRlbnQgPSBbXTtcbiAgICBjb25zdCB0ZXh0ID0gcmVzcG9uc2UubWVzc2FnZS5jb250ZW50O1xuICAgIGlmICh0ZXh0ICE9IG51bGwgJiYgdGV4dC5sZW5ndGggPiAwKSB7XG4gICAgICBjb250ZW50LnB1c2goe1xuICAgICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgICAgdGV4dFxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHRoaW5raW5nID0gcmVzcG9uc2UubWVzc2FnZS50aGlua2luZztcbiAgICBpZiAodGhpbmtpbmcgIT0gbnVsbCAmJiB0aGlua2luZy5sZW5ndGggPiAwKSB7XG4gICAgICBjb250ZW50LnB1c2goe1xuICAgICAgICB0eXBlOiBcInJlYXNvbmluZ1wiLFxuICAgICAgICB0ZXh0OiB0aGlua2luZ1xuICAgICAgfSk7XG4gICAgfVxuICAgIGZvciAoY29uc3QgdG9vbENhbGwgb2YgKF9hID0gcmVzcG9uc2UubWVzc2FnZS50b29sX2NhbGxzKSAhPSBudWxsID8gX2EgOiBbXSkge1xuICAgICAgY29udGVudC5wdXNoKHtcbiAgICAgICAgdHlwZTogXCJ0b29sLWNhbGxcIixcbiAgICAgICAgdG9vbENhbGxJZDogKF9lID0gdG9vbENhbGwuaWQpICE9IG51bGwgPyBfZSA6IChfZCA9IChfYyA9IChfYiA9IHRoaXMuY29uZmlnKS5nZW5lcmF0ZUlkKSA9PSBudWxsID8gdm9pZCAwIDogX2MuY2FsbChfYikpICE9IG51bGwgPyBfZCA6IGdlbmVyYXRlSWQyKCksXG4gICAgICAgIHRvb2xOYW1lOiB0b29sQ2FsbC5mdW5jdGlvbi5uYW1lLFxuICAgICAgICBpbnB1dDogSlNPTi5zdHJpbmdpZnkodG9vbENhbGwuZnVuY3Rpb24uYXJndW1lbnRzKVxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBjb250ZW50O1xuICB9XG4gIGV4dHJhY3RVc2FnZShyZXNwb25zZSkge1xuICAgIHZhciBfYSwgX2I7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlucHV0VG9rZW5zOiB7XG4gICAgICAgIHRvdGFsOiAoX2EgPSByZXNwb25zZS5wcm9tcHRfZXZhbF9jb3VudCkgIT0gbnVsbCA/IF9hIDogMCxcbiAgICAgICAgbm9DYWNoZTogdm9pZCAwLFxuICAgICAgICBjYWNoZVJlYWQ6IHZvaWQgMCxcbiAgICAgICAgY2FjaGVXcml0ZTogdm9pZCAwXG4gICAgICB9LFxuICAgICAgb3V0cHV0VG9rZW5zOiB7XG4gICAgICAgIHRvdGFsOiAoX2IgPSByZXNwb25zZS5ldmFsX2NvdW50KSAhPSBudWxsID8gX2IgOiAwLFxuICAgICAgICB0ZXh0OiB2b2lkIDAsXG4gICAgICAgIHJlYXNvbmluZzogdm9pZCAwXG4gICAgICB9XG4gICAgfTtcbiAgfVxufTtcbmZ1bmN0aW9uIGV4dHJhY3RPbGxhbWFSZXNwb25zZU9iamVjdHNGcm9tQ2h1bmsoY2h1bmspIHtcbiAgdmFyIF9hO1xuICBpZiAoY2h1bmsuc3VjY2Vzcykge1xuICAgIHJldHVybiBbY2h1bmsudmFsdWVdO1xuICB9XG4gIGNvbnN0IHJlc3VsdHMgPSBbXTtcbiAgY29uc3QgcmF3ID0gKF9hID0gY2h1bmsuZXJyb3IpID09IG51bGwgPyB2b2lkIDAgOiBfYS50ZXh0O1xuICBpZiAodHlwZW9mIHJhdyAhPT0gXCJzdHJpbmdcIiB8fCByYXcubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cbiAgY29uc3QgbGluZXMgPSByYXcuc3BsaXQoL1xccj9cXG4vKTtcbiAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgY29uc3QgdHJpbW1lZCA9IGxpbmUudHJpbSgpO1xuICAgIGlmICh0cmltbWVkID09PSBcIlwiKSBjb250aW51ZTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZSh0cmltbWVkKTtcbiAgICAgIGNvbnN0IHZhbGlkYXRlZCA9IGJhc2VPbGxhbWFSZXNwb25zZVNjaGVtYTIuc2FmZVBhcnNlKHBhcnNlZCk7XG4gICAgICBpZiAodmFsaWRhdGVkLnN1Y2Nlc3MpIHtcbiAgICAgICAgcmVzdWx0cy5wdXNoKHZhbGlkYXRlZC5kYXRhKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHRzO1xufVxuXG4vLyBzcmMvcmVzcG9uc2VzL29sbGFtYS1yZXNwb25zZXMtcmVxdWVzdC1idWlsZGVyLnRzXG5pbXBvcnQgeyBwYXJzZVByb3ZpZGVyT3B0aW9ucyBhcyBwYXJzZVByb3ZpZGVyT3B0aW9uczIgfSBmcm9tIFwiQGFpLXNkay9wcm92aWRlci11dGlsc1wiO1xuXG4vLyBzcmMvYWRhcHRvcnMvY29udmVydC10by1vbGxhbWEtY2hhdC1tZXNzYWdlcy50c1xuZnVuY3Rpb24gY29udmVydFRvT2xsYW1hQ2hhdE1lc3NhZ2VzKHtcbiAgcHJvbXB0LFxuICBzeXN0ZW1NZXNzYWdlTW9kZSA9IFwic3lzdGVtXCJcbn0pIHtcbiAgY29uc3QgbWVzc2FnZXMgPSBbXTtcbiAgZm9yIChjb25zdCB7IHJvbGUsIGNvbnRlbnQgfSBvZiBwcm9tcHQpIHtcbiAgICBzd2l0Y2ggKHJvbGUpIHtcbiAgICAgIGNhc2UgXCJzeXN0ZW1cIjoge1xuICAgICAgICBzd2l0Y2ggKHN5c3RlbU1lc3NhZ2VNb2RlKSB7XG4gICAgICAgICAgY2FzZSBcInN5c3RlbVwiOiB7XG4gICAgICAgICAgICBtZXNzYWdlcy5wdXNoKHsgcm9sZTogXCJzeXN0ZW1cIiwgY29udGVudCB9KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIFwiZGV2ZWxvcGVyXCI6IHtcbiAgICAgICAgICAgIG1lc3NhZ2VzLnB1c2goeyByb2xlOiBcImRldmVsb3BlclwiLCBjb250ZW50IH0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgXCJyZW1vdmVcIjoge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgIGNvbnN0IF9leGhhdXN0aXZlQ2hlY2sgPSBzeXN0ZW1NZXNzYWdlTW9kZTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgYFVuc3VwcG9ydGVkIHN5c3RlbSBtZXNzYWdlIG1vZGU6ICR7X2V4aGF1c3RpdmVDaGVja31gXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ1c2VyXCI6IHtcbiAgICAgICAgaWYgKGNvbnRlbnQubGVuZ3RoID09PSAxICYmIGNvbnRlbnRbMF0udHlwZSA9PT0gXCJ0ZXh0XCIpIHtcbiAgICAgICAgICBtZXNzYWdlcy5wdXNoKHsgcm9sZTogXCJ1c2VyXCIsIGNvbnRlbnQ6IGNvbnRlbnRbMF0udGV4dCB9KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1c2VyVGV4dCA9IGNvbnRlbnQuZmlsdGVyKChwYXJ0KSA9PiBwYXJ0LnR5cGUgPT09IFwidGV4dFwiKS5tYXAoKHBhcnQpID0+IHBhcnQudGV4dCkuam9pbihcIlwiKTtcbiAgICAgICAgY29uc3QgaW1hZ2VzID0gY29udGVudC5maWx0ZXIoKHBhcnQpID0+IHBhcnQudHlwZSA9PT0gXCJmaWxlXCIgJiYgcGFydC5tZWRpYVR5cGUuc3RhcnRzV2l0aChcImltYWdlL1wiKSkubWFwKChwYXJ0KSA9PiBwYXJ0LmRhdGEpO1xuICAgICAgICBtZXNzYWdlcy5wdXNoKHtcbiAgICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgICBjb250ZW50OiB1c2VyVGV4dC5sZW5ndGggPiAwID8gdXNlclRleHQgOiBbXSxcbiAgICAgICAgICBpbWFnZXM6IGltYWdlcy5sZW5ndGggPiAwID8gaW1hZ2VzIDogdm9pZCAwXG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJhc3Npc3RhbnRcIjoge1xuICAgICAgICBsZXQgdGV4dCA9IFwiXCI7XG4gICAgICAgIGxldCB0aGlua2luZyA9IFwiXCI7XG4gICAgICAgIGNvbnN0IHRvb2xDYWxscyA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgY29udGVudCkge1xuICAgICAgICAgIHN3aXRjaCAocGFydC50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIFwidGV4dFwiOiB7XG4gICAgICAgICAgICAgIHRleHQgKz0gcGFydC50ZXh0O1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgXCJ0b29sLWNhbGxcIjoge1xuICAgICAgICAgICAgICB0b29sQ2FsbHMucHVzaCh7XG4gICAgICAgICAgICAgICAgaWQ6IHBhcnQudG9vbENhbGxJZCxcbiAgICAgICAgICAgICAgICB0eXBlOiBcImZ1bmN0aW9uXCIsXG4gICAgICAgICAgICAgICAgZnVuY3Rpb246IHtcbiAgICAgICAgICAgICAgICAgIG5hbWU6IHBhcnQudG9vbE5hbWUsXG4gICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHBhcnQuaW5wdXRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgXCJyZWFzb25pbmdcIjoge1xuICAgICAgICAgICAgICB0aGlua2luZyArPSBwYXJ0LnRleHQ7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIHBhcnQ6ICR7cGFydH1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbWVzc2FnZXMucHVzaCh7XG4gICAgICAgICAgcm9sZTogXCJhc3Npc3RhbnRcIixcbiAgICAgICAgICBjb250ZW50OiB0ZXh0LFxuICAgICAgICAgIC4uLnRoaW5raW5nICYmIHsgdGhpbmtpbmcgfSxcbiAgICAgICAgICB0b29sX2NhbGxzOiB0b29sQ2FsbHMubGVuZ3RoID4gMCA/IHRvb2xDYWxscyA6IHZvaWQgMFxuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwidG9vbFwiOiB7XG4gICAgICAgIGZvciAoY29uc3QgdG9vbFJlc3BvbnNlIG9mIGNvbnRlbnQpIHtcbiAgICAgICAgICBjb25zdCBvdXRwdXQgPSB0b29sUmVzcG9uc2Uub3V0cHV0O1xuICAgICAgICAgIGxldCBjb250ZW50VmFsdWU7XG4gICAgICAgICAgc3dpdGNoIChvdXRwdXQudHlwZSkge1xuICAgICAgICAgICAgY2FzZSBcInRleHRcIjpcbiAgICAgICAgICAgIGNhc2UgXCJlcnJvci10ZXh0XCI6XG4gICAgICAgICAgICAgIGNvbnRlbnRWYWx1ZSA9IG91dHB1dC52YWx1ZTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiY29udGVudFwiOlxuICAgICAgICAgICAgY2FzZSBcImpzb25cIjpcbiAgICAgICAgICAgIGNhc2UgXCJlcnJvci1qc29uXCI6XG4gICAgICAgICAgICAgIGNvbnRlbnRWYWx1ZSA9IEpTT04uc3RyaW5naWZ5KG91dHB1dC52YWx1ZSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBtZXNzYWdlcy5wdXNoKHtcbiAgICAgICAgICAgIHJvbGU6IFwidG9vbFwiLFxuICAgICAgICAgICAgdG9vbF9jYWxsX2lkOiB0b29sUmVzcG9uc2UudG9vbENhbGxJZCxcbiAgICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnRWYWx1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICBjb25zdCBfZXhoYXVzdGl2ZUNoZWNrID0gcm9sZTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCByb2xlOiAke19leGhhdXN0aXZlQ2hlY2t9YCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBtZXNzYWdlcztcbn1cblxuLy8gc3JjL29sbGFtYS1jaGF0LXNldHRpbmdzLnRzXG5pbXBvcnQgeyB6IGFzIHo1IH0gZnJvbSBcInpvZC92NFwiO1xudmFyIG9sbGFtYVByb3ZpZGVyT3B0aW9ucyA9IHo1Lm9iamVjdCh7XG4gIC8qKlxuICAgKiBFbmFibGUgb3IgZGlzYWJsZSB0aGUgbW9kZWwncyB0aGlua2luZyBwcm9jZXNzLiBXaGVuIGVuYWJsZWQsIHRoZSBvdXRwdXQgd2lsbCBzZXBhcmF0ZVxuICAgKiB0aGUgbW9kZWwncyB0aGlua2luZyBmcm9tIHRoZSBtb2RlbCdzIG91dHB1dC4gV2hlbiBkaXNhYmxlZCwgdGhlIG1vZGVsIHdpbGwgbm90IHRoaW5rXG4gICAqIGFuZCBkaXJlY3RseSBvdXRwdXQgdGhlIGNvbnRlbnQuXG4gICAqXG4gICAqIE9ubHkgc3VwcG9ydGVkIGJ5IGNlcnRhaW4gbW9kZWxzIGxpa2UgRGVlcFNlZWsgUjEgYW5kIFF3ZW4gMy5cbiAgICovXG4gIHRoaW5rOiB6NS5ib29sZWFuKCkub3B0aW9uYWwoKSxcbiAgb3B0aW9uczogejUub2JqZWN0KHtcbiAgICBudW1fY3R4OiB6NS5udW1iZXIoKS5vcHRpb25hbCgpLFxuICAgIHJlcGVhdF9sYXN0X246IHo1Lm51bWJlcigpLm9wdGlvbmFsKCksXG4gICAgcmVwZWF0X3BlbmFsdHk6IHo1Lm51bWJlcigpLm9wdGlvbmFsKCksXG4gICAgdGVtcGVyYXR1cmU6IHo1Lm51bWJlcigpLm9wdGlvbmFsKCksXG4gICAgc2VlZDogejUubnVtYmVyKCkub3B0aW9uYWwoKSxcbiAgICBzdG9wOiB6NS5hcnJheSh6NS5zdHJpbmcoKSkub3B0aW9uYWwoKSxcbiAgICBudW1fcHJlZGljdDogejUubnVtYmVyKCkub3B0aW9uYWwoKSxcbiAgICB0b3BfazogejUubnVtYmVyKCkub3B0aW9uYWwoKSxcbiAgICB0b3BfcDogejUubnVtYmVyKCkub3B0aW9uYWwoKSxcbiAgICBtaW5fcDogejUubnVtYmVyKCkub3B0aW9uYWwoKVxuICB9KS5vcHRpb25hbCgpXG59KTtcblxuLy8gc3JjL3Jlc3BvbnNlcy9jb252ZXJ0LXRvLW9sbGFtYS1yZXNwb25zZXMtbWVzc2FnZXMudHNcbmltcG9ydCB7XG4gIFVuc3VwcG9ydGVkRnVuY3Rpb25hbGl0eUVycm9yIGFzIFVuc3VwcG9ydGVkRnVuY3Rpb25hbGl0eUVycm9yMlxufSBmcm9tIFwiQGFpLXNkay9wcm92aWRlclwiO1xuZnVuY3Rpb24gY29udmVydFRvT2xsYW1hUmVzcG9uc2VzTWVzc2FnZXMoe1xuICBwcm9tcHQsXG4gIHN5c3RlbU1lc3NhZ2VNb2RlXG59KSB7XG4gIGNvbnN0IG1lc3NhZ2VzID0gW107XG4gIGNvbnN0IHdhcm5pbmdzID0gW107XG4gIGZvciAoY29uc3QgeyByb2xlLCBjb250ZW50IH0gb2YgcHJvbXB0KSB7XG4gICAgc3dpdGNoIChyb2xlKSB7XG4gICAgICBjYXNlIFwic3lzdGVtXCI6IHtcbiAgICAgICAgc3dpdGNoIChzeXN0ZW1NZXNzYWdlTW9kZSkge1xuICAgICAgICAgIGNhc2UgXCJzeXN0ZW1cIjoge1xuICAgICAgICAgICAgbWVzc2FnZXMucHVzaCh7IHJvbGU6IFwic3lzdGVtXCIsIGNvbnRlbnQgfSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSBcImRldmVsb3BlclwiOiB7XG4gICAgICAgICAgICBtZXNzYWdlcy5wdXNoKHsgcm9sZTogXCJkZXZlbG9wZXJcIiwgY29udGVudCB9KTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIFwicmVtb3ZlXCI6IHtcbiAgICAgICAgICAgIHdhcm5pbmdzLnB1c2goe1xuICAgICAgICAgICAgICB0eXBlOiBcIm90aGVyXCIsXG4gICAgICAgICAgICAgIG1lc3NhZ2U6IFwic3lzdGVtIG1lc3NhZ2VzIGFyZSByZW1vdmVkIGZvciB0aGlzIG1vZGVsXCJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgIGNvbnN0IF9leGhhdXN0aXZlQ2hlY2sgPSBzeXN0ZW1NZXNzYWdlTW9kZTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgYFVuc3VwcG9ydGVkIHN5c3RlbSBtZXNzYWdlIG1vZGU6ICR7X2V4aGF1c3RpdmVDaGVja31gXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ1c2VyXCI6IHtcbiAgICAgICAgbWVzc2FnZXMucHVzaCh7XG4gICAgICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICAgICAgY29udGVudDogY29udGVudC5tYXAoKHBhcnQsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgICAgIHN3aXRjaCAocGFydC50eXBlKSB7XG4gICAgICAgICAgICAgIGNhc2UgXCJ0ZXh0XCI6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4geyB0eXBlOiBcImlucHV0X3RleHRcIiwgdGV4dDogcGFydC50ZXh0IH07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY2FzZSBcImZpbGVcIjoge1xuICAgICAgICAgICAgICAgIGlmIChwYXJ0Lm1lZGlhVHlwZS5zdGFydHNXaXRoKFwiaW1hZ2UvXCIpKSB7XG4gICAgICAgICAgICAgICAgICBjb25zdCBtZWRpYVR5cGUgPSBwYXJ0Lm1lZGlhVHlwZSA9PT0gXCJpbWFnZS8qXCIgPyBcImltYWdlL2pwZWdcIiA6IHBhcnQubWVkaWFUeXBlO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJpbnB1dF9pbWFnZVwiLFxuICAgICAgICAgICAgICAgICAgICBpbWFnZV91cmw6IHBhcnQuZGF0YSBpbnN0YW5jZW9mIFVSTCA/IHBhcnQuZGF0YS50b1N0cmluZygpIDogYGRhdGE6JHttZWRpYVR5cGV9O2Jhc2U2NCwke3BhcnQuZGF0YX1gLFxuICAgICAgICAgICAgICAgICAgICAvLyBPbGxhbWEgc3BlY2lmaWMgZXh0ZW5zaW9uOiBpbWFnZSBkZXRhaWxcbiAgICAgICAgICAgICAgICAgICAgZGV0YWlsOiAoX2IgPSAoX2EgPSBwYXJ0LnByb3ZpZGVyT3B0aW9ucykgPT0gbnVsbCA/IHZvaWQgMCA6IF9hLm9sbGFtYSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9iLmltYWdlRGV0YWlsXG4gICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocGFydC5tZWRpYVR5cGUgPT09IFwiYXBwbGljYXRpb24vcGRmXCIpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChwYXJ0LmRhdGEgaW5zdGFuY2VvZiBVUkwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkRnVuY3Rpb25hbGl0eUVycm9yMih7XG4gICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25hbGl0eTogXCJQREYgZmlsZSBwYXJ0cyB3aXRoIFVSTHNcIlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiaW5wdXRfZmlsZVwiLFxuICAgICAgICAgICAgICAgICAgICBmaWxlbmFtZTogKF9jID0gcGFydC5maWxlbmFtZSkgIT0gbnVsbCA/IF9jIDogYHBhcnQtJHtpbmRleH0ucGRmYCxcbiAgICAgICAgICAgICAgICAgICAgZmlsZV9kYXRhOiBgZGF0YTphcHBsaWNhdGlvbi9wZGY7YmFzZTY0LCR7cGFydC5kYXRhfWBcbiAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEZ1bmN0aW9uYWxpdHlFcnJvcjIoe1xuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbmFsaXR5OiBgZmlsZSBwYXJ0IG1lZGlhIHR5cGUgJHtwYXJ0Lm1lZGlhVHlwZX1gXG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYXNzaXN0YW50XCI6IHtcbiAgICAgICAgZm9yIChjb25zdCBwYXJ0IG9mIGNvbnRlbnQpIHtcbiAgICAgICAgICBzd2l0Y2ggKHBhcnQudHlwZSkge1xuICAgICAgICAgICAgY2FzZSBcInRleHRcIjoge1xuICAgICAgICAgICAgICBtZXNzYWdlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICByb2xlOiBcImFzc2lzdGFudFwiLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IFt7IHR5cGU6IFwib3V0cHV0X3RleHRcIiwgdGV4dDogcGFydC50ZXh0IH1dXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgXCJ0b29sLWNhbGxcIjoge1xuICAgICAgICAgICAgICBpZiAocGFydC5wcm92aWRlckV4ZWN1dGVkKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgbWVzc2FnZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJmdW5jdGlvbl9jYWxsXCIsXG4gICAgICAgICAgICAgICAgY2FsbF9pZDogcGFydC50b29sQ2FsbElkLFxuICAgICAgICAgICAgICAgIG5hbWU6IHBhcnQudG9vbE5hbWUsXG4gICAgICAgICAgICAgICAgYXJndW1lbnRzOiBKU09OLnN0cmluZ2lmeShwYXJ0LmlucHV0KVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFwidG9vbC1yZXN1bHRcIjoge1xuICAgICAgICAgICAgICB3YXJuaW5ncy5wdXNoKHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIm90aGVyXCIsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogYHRvb2wgcmVzdWx0IHBhcnRzIGluIGFzc2lzdGFudCBtZXNzYWdlcyBhcmUgbm90IHN1cHBvcnRlZCBmb3IgT2xsYW1hIHJlc3BvbnNlc2BcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ0b29sXCI6IHtcbiAgICAgICAgZm9yIChjb25zdCBwYXJ0IG9mIGNvbnRlbnQpIHtcbiAgICAgICAgICBjb25zdCBvdXRwdXQgPSBwYXJ0Lm91dHB1dDtcbiAgICAgICAgICBsZXQgY29udGVudFZhbHVlO1xuICAgICAgICAgIHN3aXRjaCAob3V0cHV0LnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJ0ZXh0XCI6XG4gICAgICAgICAgICBjYXNlIFwiZXJyb3ItdGV4dFwiOlxuICAgICAgICAgICAgICBjb250ZW50VmFsdWUgPSBvdXRwdXQudmFsdWU7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImNvbnRlbnRcIjpcbiAgICAgICAgICAgIGNhc2UgXCJqc29uXCI6XG4gICAgICAgICAgICBjYXNlIFwiZXJyb3ItanNvblwiOlxuICAgICAgICAgICAgICBjb250ZW50VmFsdWUgPSBKU09OLnN0cmluZ2lmeShvdXRwdXQudmFsdWUpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgbWVzc2FnZXMucHVzaCh7XG4gICAgICAgICAgICB0eXBlOiBcImZ1bmN0aW9uX2NhbGxfb3V0cHV0XCIsXG4gICAgICAgICAgICBjYWxsX2lkOiBwYXJ0LnRvb2xDYWxsSWQsXG4gICAgICAgICAgICBvdXRwdXQ6IGNvbnRlbnRWYWx1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICBjb25zdCBfZXhoYXVzdGl2ZUNoZWNrID0gcm9sZTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCByb2xlOiAke19leGhhdXN0aXZlQ2hlY2t9YCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiB7IG1lc3NhZ2VzLCB3YXJuaW5ncyB9O1xufVxuXG4vLyBzcmMvcmVzcG9uc2VzL29sbGFtYS1yZXNwb25zZXMtcHJlcGFyZS10b29scy50c1xuaW1wb3J0IHtcbiAgVW5zdXBwb3J0ZWRGdW5jdGlvbmFsaXR5RXJyb3IgYXMgVW5zdXBwb3J0ZWRGdW5jdGlvbmFsaXR5RXJyb3IzXG59IGZyb20gXCJAYWktc2RrL3Byb3ZpZGVyXCI7XG5mdW5jdGlvbiBwcmVwYXJlUmVzcG9uc2VzVG9vbHMoe1xuICB0b29scyxcbiAgdG9vbENob2ljZVxufSkge1xuICB0b29scyA9ICh0b29scyA9PSBudWxsID8gdm9pZCAwIDogdG9vbHMubGVuZ3RoKSA/IHRvb2xzIDogdm9pZCAwO1xuICBjb25zdCB0b29sV2FybmluZ3MgPSBbXTtcbiAgaWYgKHRvb2xzID09IG51bGwpIHtcbiAgICByZXR1cm4geyB0b29sczogdm9pZCAwLCB0b29sQ2hvaWNlOiB2b2lkIDAsIHRvb2xXYXJuaW5ncyB9O1xuICB9XG4gIGNvbnN0IG9sbGFtYVRvb2xzID0gW107XG4gIGZvciAoY29uc3QgdG9vbCBvZiB0b29scykge1xuICAgIHN3aXRjaCAodG9vbC50eXBlKSB7XG4gICAgICBjYXNlIFwiZnVuY3Rpb25cIjoge1xuICAgICAgICBsZXQgcGFyYW1ldGVycyA9IHRvb2wuaW5wdXRTY2hlbWE7XG4gICAgICAgIGlmICghcGFyYW1ldGVycykge1xuICAgICAgICAgIHBhcmFtZXRlcnMgPSB7XG4gICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgcHJvcGVydGllczoge30sXG4gICAgICAgICAgICByZXF1aXJlZDogW11cbiAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2UgaWYgKHBhcmFtZXRlcnMgJiYgdHlwZW9mIHBhcmFtZXRlcnMgPT09IFwib2JqZWN0XCIgJiYgcGFyYW1ldGVycy50eXBlID09PSBcIm9iamVjdFwiICYmIHBhcmFtZXRlcnMucHJvcGVydGllcyAmJiBPYmplY3Qua2V5cyhwYXJhbWV0ZXJzLnByb3BlcnRpZXMpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHBhcmFtZXRlcnMgPSB7XG4gICAgICAgICAgICAuLi5wYXJhbWV0ZXJzLFxuICAgICAgICAgICAgcHJvcGVydGllczoge30sXG4gICAgICAgICAgICByZXF1aXJlZDogW11cbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIG9sbGFtYVRvb2xzLnB1c2goe1xuICAgICAgICAgIHR5cGU6IFwiZnVuY3Rpb25cIixcbiAgICAgICAgICBmdW5jdGlvbjoge1xuICAgICAgICAgICAgbmFtZTogdG9vbC5uYW1lLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IHRvb2wuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICBwYXJhbWV0ZXJzXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0b29sV2FybmluZ3MucHVzaCh7IHR5cGU6IFwidW5zdXBwb3J0ZWRcIiwgZmVhdHVyZTogXCJ0b29sXCIsIGRldGFpbHM6IHRvb2wubmFtZSB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG4gIGlmICh0b29sQ2hvaWNlID09IG51bGwpIHtcbiAgICByZXR1cm4geyB0b29sczogb2xsYW1hVG9vbHMsIHRvb2xDaG9pY2U6IHZvaWQgMCwgdG9vbFdhcm5pbmdzIH07XG4gIH1cbiAgY29uc3QgdHlwZSA9IHRvb2xDaG9pY2UudHlwZTtcbiAgc3dpdGNoICh0eXBlKSB7XG4gICAgY2FzZSBcImF1dG9cIjpcbiAgICBjYXNlIFwibm9uZVwiOlxuICAgIGNhc2UgXCJyZXF1aXJlZFwiOlxuICAgICAgcmV0dXJuIHsgdG9vbHM6IG9sbGFtYVRvb2xzLCB0b29sQ2hvaWNlOiB0eXBlLCB0b29sV2FybmluZ3MgfTtcbiAgICBjYXNlIFwidG9vbFwiOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdG9vbHM6IG9sbGFtYVRvb2xzLFxuICAgICAgICB0b29sQ2hvaWNlOiB0b29sQ2hvaWNlLnRvb2xOYW1lID09IFwid2ViX3NlYXJjaF9wcmV2aWV3XCIgPyB7IHR5cGU6IFwid2ViX3NlYXJjaF9wcmV2aWV3XCIgfSA6IHsgdHlwZTogXCJmdW5jdGlvblwiLCBuYW1lOiB0b29sQ2hvaWNlLnRvb2xOYW1lIH0sXG4gICAgICAgIHRvb2xXYXJuaW5nc1xuICAgICAgfTtcbiAgICBkZWZhdWx0OiB7XG4gICAgICBjb25zdCBfZXhoYXVzdGl2ZUNoZWNrID0gdHlwZTtcbiAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZEZ1bmN0aW9uYWxpdHlFcnJvcjMoe1xuICAgICAgICBmdW5jdGlvbmFsaXR5OiBgdG9vbCBjaG9pY2UgdHlwZTogJHtfZXhoYXVzdGl2ZUNoZWNrfWBcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuXG4vLyBzcmMvcmVzcG9uc2VzL29sbGFtYS1yZXNwb25zZXMtcmVxdWVzdC1idWlsZGVyLnRzXG52YXIgT2xsYW1hUmVxdWVzdEJ1aWxkZXIgPSBjbGFzcyB7XG4gIGFzeW5jIGJ1aWxkUmVxdWVzdCh7XG4gICAgbW9kZWxJZCxcbiAgICBtYXhPdXRwdXRUb2tlbnMsXG4gICAgdGVtcGVyYXR1cmUsXG4gICAgc3RvcFNlcXVlbmNlcyxcbiAgICB0b3BQLFxuICAgIHRvcEssXG4gICAgcHJlc2VuY2VQZW5hbHR5LFxuICAgIGZyZXF1ZW5jeVBlbmFsdHksXG4gICAgc2VlZCxcbiAgICBwcm9tcHQsXG4gICAgcHJvdmlkZXJPcHRpb25zLFxuICAgIHRvb2xzLFxuICAgIHRvb2xDaG9pY2UsXG4gICAgcmVzcG9uc2VGb3JtYXRcbiAgfSkge1xuICAgIGNvbnN0IHdhcm5pbmdzID0gdGhpcy5jb2xsZWN0VW5zdXBwb3J0ZWRTZXR0aW5nc1dhcm5pbmdzKHtcbiAgICAgIHRvcEssXG4gICAgICBzZWVkLFxuICAgICAgcHJlc2VuY2VQZW5hbHR5LFxuICAgICAgZnJlcXVlbmN5UGVuYWx0eSxcbiAgICAgIHN0b3BTZXF1ZW5jZXNcbiAgICB9KTtcbiAgICBjb25zdCB7IG1lc3NhZ2VzLCB3YXJuaW5nczogbWVzc2FnZVdhcm5pbmdzIH0gPSBjb252ZXJ0VG9PbGxhbWFSZXNwb25zZXNNZXNzYWdlcyh7XG4gICAgICBwcm9tcHQsXG4gICAgICBzeXN0ZW1NZXNzYWdlTW9kZTogXCJzeXN0ZW1cIlxuICAgIH0pO1xuICAgIHdhcm5pbmdzLnB1c2goLi4ubWVzc2FnZVdhcm5pbmdzKTtcbiAgICBjb25zdCBvbGxhbWFPcHRpb25zID0gYXdhaXQgdGhpcy5wYXJzZVByb3ZpZGVyT3B0aW9ucyhwcm92aWRlck9wdGlvbnMpO1xuICAgIGNvbnN0IGJhc2VBcmdzID0gdGhpcy5idWlsZEJhc2VBcmdzKHtcbiAgICAgIG1vZGVsSWQsXG4gICAgICBwcm9tcHQsXG4gICAgICB0ZW1wZXJhdHVyZSxcbiAgICAgIHRvcFAsXG4gICAgICBtYXhPdXRwdXRUb2tlbnMsXG4gICAgICByZXNwb25zZUZvcm1hdCxcbiAgICAgIG9sbGFtYU9wdGlvbnNcbiAgICB9KTtcbiAgICBjb25zdCB7IHRvb2xzOiBvbGxhbWFUb29scywgdG9vbENob2ljZTogb2xsYW1hVG9vbENob2ljZSwgdG9vbFdhcm5pbmdzIH0gPSBwcmVwYXJlUmVzcG9uc2VzVG9vbHMoe1xuICAgICAgdG9vbHMsXG4gICAgICB0b29sQ2hvaWNlXG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFyZ3M6IHtcbiAgICAgICAgLi4uYmFzZUFyZ3MsXG4gICAgICAgIHRvb2xzOiBvbGxhbWFUb29scyxcbiAgICAgICAgdG9vbF9jaG9pY2U6IG9sbGFtYVRvb2xDaG9pY2VcbiAgICAgIH0sXG4gICAgICB3YXJuaW5nczogWy4uLndhcm5pbmdzLCAuLi50b29sV2FybmluZ3NdXG4gICAgfTtcbiAgfVxuICBjb2xsZWN0VW5zdXBwb3J0ZWRTZXR0aW5nc1dhcm5pbmdzKHtcbiAgICB0b3BLLFxuICAgIHNlZWQsXG4gICAgcHJlc2VuY2VQZW5hbHR5LFxuICAgIGZyZXF1ZW5jeVBlbmFsdHksXG4gICAgc3RvcFNlcXVlbmNlc1xuICB9KSB7XG4gICAgY29uc3Qgd2FybmluZ3MgPSBbXTtcbiAgICBjb25zdCB1bnN1cHBvcnRlZFNldHRpbmdzID0gW1xuICAgICAgeyB2YWx1ZTogdG9wSywgbmFtZTogXCJ0b3BLXCIgfSxcbiAgICAgIHsgdmFsdWU6IHNlZWQsIG5hbWU6IFwic2VlZFwiIH0sXG4gICAgICB7IHZhbHVlOiBwcmVzZW5jZVBlbmFsdHksIG5hbWU6IFwicHJlc2VuY2VQZW5hbHR5XCIgfSxcbiAgICAgIHsgdmFsdWU6IGZyZXF1ZW5jeVBlbmFsdHksIG5hbWU6IFwiZnJlcXVlbmN5UGVuYWx0eVwiIH0sXG4gICAgICB7IHZhbHVlOiBzdG9wU2VxdWVuY2VzLCBuYW1lOiBcInN0b3BTZXF1ZW5jZXNcIiB9XG4gICAgXTtcbiAgICBmb3IgKGNvbnN0IHsgdmFsdWUsIG5hbWUgfSBvZiB1bnN1cHBvcnRlZFNldHRpbmdzKSB7XG4gICAgICBpZiAodmFsdWUgIT0gbnVsbCkge1xuICAgICAgICB3YXJuaW5ncy5wdXNoKHsgdHlwZTogXCJ1bnN1cHBvcnRlZFwiLCBmZWF0dXJlOiBcInNldHRpbmdcIiwgZGV0YWlsczogbmFtZSB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHdhcm5pbmdzO1xuICB9XG4gIGFzeW5jIHBhcnNlUHJvdmlkZXJPcHRpb25zKHByb3ZpZGVyT3B0aW9ucykge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBhcnNlUHJvdmlkZXJPcHRpb25zMih7XG4gICAgICBwcm92aWRlcjogXCJvbGxhbWFcIixcbiAgICAgIHByb3ZpZGVyT3B0aW9ucyxcbiAgICAgIHNjaGVtYTogb2xsYW1hUHJvdmlkZXJPcHRpb25zXG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdCAhPSBudWxsID8gcmVzdWx0IDogbnVsbDtcbiAgfVxuICBidWlsZEJhc2VBcmdzKHtcbiAgICBtb2RlbElkLFxuICAgIHByb21wdCxcbiAgICB0ZW1wZXJhdHVyZSxcbiAgICB0b3BQLFxuICAgIG1heE91dHB1dFRva2VucyxcbiAgICByZXNwb25zZUZvcm1hdCxcbiAgICBvbGxhbWFPcHRpb25zXG4gIH0pIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIHJldHVybiB7XG4gICAgICBtb2RlbDogbW9kZWxJZCxcbiAgICAgIG1lc3NhZ2VzOiBjb252ZXJ0VG9PbGxhbWFDaGF0TWVzc2FnZXMoe1xuICAgICAgICBwcm9tcHQsXG4gICAgICAgIHN5c3RlbU1lc3NhZ2VNb2RlOiBcInN5c3RlbVwiXG4gICAgICB9KSxcbiAgICAgIHRlbXBlcmF0dXJlLFxuICAgICAgdG9wX3A6IHRvcFAsXG4gICAgICBtYXhfb3V0cHV0X3Rva2VuczogbWF4T3V0cHV0VG9rZW5zLFxuICAgICAgLi4uKHJlc3BvbnNlRm9ybWF0ID09IG51bGwgPyB2b2lkIDAgOiByZXNwb25zZUZvcm1hdC50eXBlKSA9PT0gXCJqc29uXCIgJiYge1xuICAgICAgICBmb3JtYXQ6IHJlc3BvbnNlRm9ybWF0LnNjaGVtYSAhPSBudWxsID8gcmVzcG9uc2VGb3JtYXQuc2NoZW1hIDogXCJqc29uXCJcbiAgICAgIH0sXG4gICAgICB0aGluazogKF9hID0gb2xsYW1hT3B0aW9ucyA9PSBudWxsID8gdm9pZCAwIDogb2xsYW1hT3B0aW9ucy50aGluaykgIT0gbnVsbCA/IF9hIDogZmFsc2UsXG4gICAgICBvcHRpb25zOiAoX2IgPSBvbGxhbWFPcHRpb25zID09IG51bGwgPyB2b2lkIDAgOiBvbGxhbWFPcHRpb25zLm9wdGlvbnMpICE9IG51bGwgPyBfYiA6IHZvaWQgMFxuICAgIH07XG4gIH1cbn07XG5cbi8vIHNyYy9yZXNwb25zZXMvb2xsYW1hLXJlc3BvbnNlcy1zdHJlYW0tcHJvY2Vzc29yLnRzXG5pbXBvcnQge1xuICBJbnZhbGlkUmVzcG9uc2VEYXRhRXJyb3Jcbn0gZnJvbSBcIkBhaS1zZGsvcHJvdmlkZXJcIjtcbmltcG9ydCB7IGdlbmVyYXRlSWQgYXMgZ2VuZXJhdGVJZDMgfSBmcm9tIFwiQGFpLXNkay9wcm92aWRlci11dGlsc1wiO1xudmFyIE9sbGFtYVN0cmVhbVByb2Nlc3NvciA9IGNsYXNzIHtcbiAgY29uc3RydWN0b3IoY29uZmlnKSB7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gICAgdGhpcy5zdGF0ZSA9IHRoaXMuaW5pdGlhbGl6ZVN0YXRlKCk7XG4gIH1cbiAgY3JlYXRlVHJhbnNmb3JtU3RyZWFtKHdhcm5pbmdzLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIG5ldyBUcmFuc2Zvcm1TdHJlYW0oe1xuICAgICAgdHJhbnNmb3JtOiAoY2h1bmssIGNvbnRyb2xsZXIpID0+IHtcbiAgICAgICAgdGhpcy5wcm9jZXNzQ2h1bmsoY2h1bmssIGNvbnRyb2xsZXIsIG9wdGlvbnMpO1xuICAgICAgfSxcbiAgICAgIGZsdXNoOiAoY29udHJvbGxlcikgPT4ge1xuICAgICAgICB0aGlzLmZpbmFsaXplU3RyZWFtKGNvbnRyb2xsZXIpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGluaXRpYWxpemVTdGF0ZSgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgZmluaXNoUmVhc29uOiB7XG4gICAgICAgIHVuaWZpZWQ6IFwib3RoZXJcIixcbiAgICAgICAgcmF3OiB2b2lkIDBcbiAgICAgIH0sXG4gICAgICB1c2FnZToge1xuICAgICAgICBpbnB1dFRva2Vuczoge1xuICAgICAgICAgIHRvdGFsOiB2b2lkIDAsXG4gICAgICAgICAgbm9DYWNoZTogdm9pZCAwLFxuICAgICAgICAgIGNhY2hlUmVhZDogdm9pZCAwLFxuICAgICAgICAgIGNhY2hlV3JpdGU6IHZvaWQgMFxuICAgICAgICB9LFxuICAgICAgICBvdXRwdXRUb2tlbnM6IHtcbiAgICAgICAgICB0b3RhbDogdm9pZCAwLFxuICAgICAgICAgIHRleHQ6IHZvaWQgMCxcbiAgICAgICAgICByZWFzb25pbmc6IHZvaWQgMFxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcmVzcG9uc2VJZDogbnVsbCxcbiAgICAgIG9uZ29pbmdUb29sQ2FsbHM6IHt9LFxuICAgICAgaGFzVG9vbENhbGxzOiBmYWxzZSxcbiAgICAgIGlzRmlyc3RDaHVuazogdHJ1ZSxcbiAgICAgIGhhc1RleHRTdGFydGVkOiBmYWxzZSxcbiAgICAgIGhhc1JlYXNvbmluZ1N0YXJ0ZWQ6IGZhbHNlLFxuICAgICAgdGV4dEVuZGVkOiBmYWxzZSxcbiAgICAgIHJlYXNvbmluZ0VuZGVkOiBmYWxzZSxcbiAgICAgIHRleHRJZDogZ2VuZXJhdGVJZDMoKSxcbiAgICAgIHJlYXNvbmluZ0lkOiBnZW5lcmF0ZUlkMygpXG4gICAgfTtcbiAgfVxuICBwcm9jZXNzQ2h1bmsoY2h1bmssIGNvbnRyb2xsZXIsIG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucyA9PSBudWxsID8gdm9pZCAwIDogb3B0aW9ucy5pbmNsdWRlUmF3Q2h1bmtzKSB7XG4gICAgICBjb250cm9sbGVyLmVucXVldWUoeyB0eXBlOiBcInJhd1wiLCByYXdWYWx1ZTogY2h1bmsucmF3VmFsdWUgfSk7XG4gICAgfVxuICAgIGNvbnN0IHZhbHVlcyA9IGV4dHJhY3RPbGxhbWFSZXNwb25zZU9iamVjdHNGcm9tQ2h1bmsoY2h1bmspO1xuICAgIGlmICh2YWx1ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBpZiAoIWNodW5rLnN1Y2Nlc3MpIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5maW5pc2hSZWFzb24gPSB7IHVuaWZpZWQ6IFwiZXJyb3JcIiwgcmF3OiB2b2lkIDAgfTtcbiAgICAgICAgY29udHJvbGxlci5lbnF1ZXVlKHsgdHlwZTogXCJlcnJvclwiLCBlcnJvcjogY2h1bmsuZXJyb3IgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGZvciAoY29uc3QgdmFsdWUgb2YgdmFsdWVzKSB7XG4gICAgICB0aGlzLnByb2Nlc3NSZXNwb25zZVZhbHVlKHZhbHVlLCBjb250cm9sbGVyKTtcbiAgICB9XG4gIH1cbiAgcHJvY2Vzc1Jlc3BvbnNlVmFsdWUodmFsdWUsIGNvbnRyb2xsZXIpIHtcbiAgICBpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmIFwiZXJyb3JcIiBpbiB2YWx1ZSkge1xuICAgICAgdGhpcy5zdGF0ZS5maW5pc2hSZWFzb24gPSB7IHVuaWZpZWQ6IFwiZXJyb3JcIiwgcmF3OiB2b2lkIDAgfTtcbiAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZSh7IHR5cGU6IFwiZXJyb3JcIiwgZXJyb3I6IHZhbHVlLmVycm9yIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGhpcy5zdGF0ZS5pc0ZpcnN0Q2h1bmspIHtcbiAgICAgIHRoaXMuc3RhdGUuaXNGaXJzdENodW5rID0gZmFsc2U7XG4gICAgICBjb250cm9sbGVyLmVucXVldWUoe1xuICAgICAgICB0eXBlOiBcInJlc3BvbnNlLW1ldGFkYXRhXCIsXG4gICAgICAgIC4uLmdldFJlc3BvbnNlTWV0YWRhdGEodmFsdWUpXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHZhbHVlLmRvbmUpIHtcbiAgICAgIHRoaXMuaGFuZGxlRG9uZUNodW5rKHZhbHVlLCBjb250cm9sbGVyKTtcbiAgICB9XG4gICAgY29uc3QgZGVsdGEgPSB2YWx1ZSA9PSBudWxsID8gdm9pZCAwIDogdmFsdWUubWVzc2FnZTtcbiAgICBpZiAoZGVsdGEpIHtcbiAgICAgIHRoaXMucHJvY2Vzc0RlbHRhKGRlbHRhLCBjb250cm9sbGVyKTtcbiAgICB9XG4gIH1cbiAgaGFuZGxlRG9uZUNodW5rKHZhbHVlLCBjb250cm9sbGVyKSB7XG4gICAgdGhpcy5zdGF0ZS5maW5pc2hSZWFzb24gPSBtYXBPbGxhbWFGaW5pc2hSZWFzb24odmFsdWUuZG9uZV9yZWFzb24pO1xuICAgIHRoaXMuc3RhdGUudXNhZ2UgPSB7XG4gICAgICBpbnB1dFRva2Vuczoge1xuICAgICAgICB0b3RhbDogdmFsdWUucHJvbXB0X2V2YWxfY291bnQgfHwgMCxcbiAgICAgICAgbm9DYWNoZTogdm9pZCAwLFxuICAgICAgICBjYWNoZVJlYWQ6IHZvaWQgMCxcbiAgICAgICAgY2FjaGVXcml0ZTogdm9pZCAwXG4gICAgICB9LFxuICAgICAgb3V0cHV0VG9rZW5zOiB7XG4gICAgICAgIHRvdGFsOiB2YWx1ZS5ldmFsX2NvdW50IHx8IDAsXG4gICAgICAgIHRleHQ6IHZvaWQgMCxcbiAgICAgICAgcmVhc29uaW5nOiB2b2lkIDBcbiAgICAgIH1cbiAgICB9O1xuICAgIGlmICh0aGlzLnN0YXRlLmhhc1RleHRTdGFydGVkICYmICF0aGlzLnN0YXRlLnRleHRFbmRlZCkge1xuICAgICAgY29udHJvbGxlci5lbnF1ZXVlKHsgdHlwZTogXCJ0ZXh0LWVuZFwiLCBpZDogdGhpcy5zdGF0ZS50ZXh0SWQgfSk7XG4gICAgICB0aGlzLnN0YXRlLnRleHRFbmRlZCA9IHRydWU7XG4gICAgfVxuICAgIGlmICh0aGlzLnN0YXRlLmhhc1JlYXNvbmluZ1N0YXJ0ZWQgJiYgIXRoaXMuc3RhdGUucmVhc29uaW5nRW5kZWQpIHtcbiAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZSh7IHR5cGU6IFwicmVhc29uaW5nLWVuZFwiLCBpZDogdGhpcy5zdGF0ZS5yZWFzb25pbmdJZCB9KTtcbiAgICAgIHRoaXMuc3RhdGUucmVhc29uaW5nRW5kZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxuICBwcm9jZXNzRGVsdGEoZGVsdGEsIGNvbnRyb2xsZXIpIHtcbiAgICB0aGlzLnByb2Nlc3NUZXh0Q29udGVudChkZWx0YSwgY29udHJvbGxlcik7XG4gICAgdGhpcy5wcm9jZXNzVGhpbmtpbmcoZGVsdGEsIGNvbnRyb2xsZXIpO1xuICAgIHRoaXMucHJvY2Vzc1Rvb2xDYWxscyhkZWx0YSwgY29udHJvbGxlcik7XG4gIH1cbiAgcHJvY2Vzc1RleHRDb250ZW50KGRlbHRhLCBjb250cm9sbGVyKSB7XG4gICAgaWYgKChkZWx0YSA9PSBudWxsID8gdm9pZCAwIDogZGVsdGEuY29udGVudCkgIT0gbnVsbCkge1xuICAgICAgaWYgKCF0aGlzLnN0YXRlLmhhc1RleHRTdGFydGVkKSB7XG4gICAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZSh7IHR5cGU6IFwidGV4dC1zdGFydFwiLCBpZDogdGhpcy5zdGF0ZS50ZXh0SWQgfSk7XG4gICAgICAgIHRoaXMuc3RhdGUuaGFzVGV4dFN0YXJ0ZWQgPSB0cnVlO1xuICAgICAgfVxuICAgICAgY29udHJvbGxlci5lbnF1ZXVlKHtcbiAgICAgICAgdHlwZTogXCJ0ZXh0LWRlbHRhXCIsXG4gICAgICAgIGlkOiB0aGlzLnN0YXRlLnRleHRJZCxcbiAgICAgICAgZGVsdGE6IGRlbHRhLmNvbnRlbnRcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICBwcm9jZXNzVGhpbmtpbmcoZGVsdGEsIGNvbnRyb2xsZXIpIHtcbiAgICBpZiAoZGVsdGEgPT0gbnVsbCA/IHZvaWQgMCA6IGRlbHRhLnRoaW5raW5nKSB7XG4gICAgICBpZiAoIXRoaXMuc3RhdGUuaGFzUmVhc29uaW5nU3RhcnRlZCkge1xuICAgICAgICBjb250cm9sbGVyLmVucXVldWUoeyB0eXBlOiBcInJlYXNvbmluZy1zdGFydFwiLCBpZDogdGhpcy5zdGF0ZS5yZWFzb25pbmdJZCB9KTtcbiAgICAgICAgdGhpcy5zdGF0ZS5oYXNSZWFzb25pbmdTdGFydGVkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZSh7XG4gICAgICAgIHR5cGU6IFwicmVhc29uaW5nLWRlbHRhXCIsXG4gICAgICAgIGlkOiB0aGlzLnN0YXRlLnJlYXNvbmluZ0lkLFxuICAgICAgICBkZWx0YTogZGVsdGEudGhpbmtpbmdcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICBwcm9jZXNzVG9vbENhbGxzKGRlbHRhLCBjb250cm9sbGVyKSB7XG4gICAgdmFyIF9hLCBfYiwgX2MsIF9kO1xuICAgIGZvciAoY29uc3QgdG9vbENhbGwgb2YgKF9hID0gZGVsdGEudG9vbF9jYWxscykgIT0gbnVsbCA/IF9hIDogW10pIHtcbiAgICAgIGlmICgoKF9iID0gdG9vbENhbGwuZnVuY3Rpb24pID09IG51bGwgPyB2b2lkIDAgOiBfYi5uYW1lKSA9PSBudWxsKSB7XG4gICAgICAgIHRocm93IG5ldyBJbnZhbGlkUmVzcG9uc2VEYXRhRXJyb3Ioe1xuICAgICAgICAgIGRhdGE6IHRvb2xDYWxsLFxuICAgICAgICAgIG1lc3NhZ2U6IGBFeHBlY3RlZCAnZnVuY3Rpb24ubmFtZScgdG8gYmUgYSBzdHJpbmcuYFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmICgoKF9jID0gdG9vbENhbGwuZnVuY3Rpb24pID09IG51bGwgPyB2b2lkIDAgOiBfYy5uYW1lKSAhPSBudWxsICYmICgoX2QgPSB0b29sQ2FsbC5mdW5jdGlvbikgPT0gbnVsbCA/IHZvaWQgMCA6IF9kLmFyZ3VtZW50cykgIT0gbnVsbCkge1xuICAgICAgICB0aGlzLmVtaXRUb29sQ2FsbCh0b29sQ2FsbCwgY29udHJvbGxlcik7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGVtaXRUb29sQ2FsbCh0b29sQ2FsbCwgY29udHJvbGxlcikge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICBjb25zdCBpZCA9IChfZCA9IHRvb2xDYWxsLmlkKSAhPSBudWxsID8gX2QgOiAoX2MgPSAoX2IgPSAoX2EgPSB0aGlzLmNvbmZpZykuZ2VuZXJhdGVJZCkgPT0gbnVsbCA/IHZvaWQgMCA6IF9iLmNhbGwoX2EpKSAhPSBudWxsID8gX2MgOiBnZW5lcmF0ZUlkMygpO1xuICAgIGNvbnRyb2xsZXIuZW5xdWV1ZSh7XG4gICAgICB0eXBlOiBcInRvb2wtaW5wdXQtc3RhcnRcIixcbiAgICAgIGlkLFxuICAgICAgdG9vbE5hbWU6IHRvb2xDYWxsLmZ1bmN0aW9uLm5hbWVcbiAgICB9KTtcbiAgICBjb250cm9sbGVyLmVucXVldWUoe1xuICAgICAgdHlwZTogXCJ0b29sLWlucHV0LWRlbHRhXCIsXG4gICAgICBpZCxcbiAgICAgIGRlbHRhOiBKU09OLnN0cmluZ2lmeSh0b29sQ2FsbC5mdW5jdGlvbi5hcmd1bWVudHMpXG4gICAgfSk7XG4gICAgY29udHJvbGxlci5lbnF1ZXVlKHtcbiAgICAgIHR5cGU6IFwidG9vbC1pbnB1dC1lbmRcIixcbiAgICAgIGlkXG4gICAgfSk7XG4gICAgY29udHJvbGxlci5lbnF1ZXVlKHtcbiAgICAgIHR5cGU6IFwidG9vbC1jYWxsXCIsXG4gICAgICB0b29sQ2FsbElkOiBpZCxcbiAgICAgIHRvb2xOYW1lOiB0b29sQ2FsbC5mdW5jdGlvbi5uYW1lLFxuICAgICAgaW5wdXQ6IEpTT04uc3RyaW5naWZ5KHRvb2xDYWxsLmZ1bmN0aW9uLmFyZ3VtZW50cylcbiAgICB9KTtcbiAgICB0aGlzLnN0YXRlLmhhc1Rvb2xDYWxscyA9IHRydWU7XG4gIH1cbiAgZmluYWxpemVTdHJlYW0oY29udHJvbGxlcikge1xuICAgIGlmICh0aGlzLnN0YXRlLmhhc1RleHRTdGFydGVkICYmICF0aGlzLnN0YXRlLnRleHRFbmRlZCkge1xuICAgICAgY29udHJvbGxlci5lbnF1ZXVlKHsgdHlwZTogXCJ0ZXh0LWVuZFwiLCBpZDogdGhpcy5zdGF0ZS50ZXh0SWQgfSk7XG4gICAgfVxuICAgIGlmICh0aGlzLnN0YXRlLmhhc1JlYXNvbmluZ1N0YXJ0ZWQgJiYgIXRoaXMuc3RhdGUucmVhc29uaW5nRW5kZWQpIHtcbiAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZSh7IHR5cGU6IFwicmVhc29uaW5nLWVuZFwiLCBpZDogdGhpcy5zdGF0ZS5yZWFzb25pbmdJZCB9KTtcbiAgICB9XG4gICAgY29udHJvbGxlci5lbnF1ZXVlKHtcbiAgICAgIHR5cGU6IFwiZmluaXNoXCIsXG4gICAgICBmaW5pc2hSZWFzb246IHRoaXMuc3RhdGUuZmluaXNoUmVhc29uLFxuICAgICAgdXNhZ2U6IHRoaXMuc3RhdGUudXNhZ2UsXG4gICAgICBwcm92aWRlck1ldGFkYXRhOiB7XG4gICAgICAgIG9sbGFtYToge1xuICAgICAgICAgIHJlc3BvbnNlSWQ6IHRoaXMuc3RhdGUucmVzcG9uc2VJZFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn07XG5cbi8vIHNyYy9yZXNwb25zZXMvb2xsYW1hLXJlc3BvbnNlcy1sYW5ndWFnZS1tb2RlbC50c1xudmFyIE9sbGFtYVJlc3BvbnNlc0xhbmd1YWdlTW9kZWwgPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKG1vZGVsSWQsIGNvbmZpZykge1xuICAgIHRoaXMuc3BlY2lmaWNhdGlvblZlcnNpb24gPSBcInYzXCI7XG4gICAgdGhpcy5kZWZhdWx0T2JqZWN0R2VuZXJhdGlvbk1vZGUgPSB2b2lkIDA7XG4gICAgdGhpcy5zdXBwb3J0c0ltYWdlVXJscyA9IHRydWU7XG4gICAgdGhpcy5zdXBwb3J0ZWRVcmxzID0ge1xuICAgICAgXCJpbWFnZS8qXCI6IFtcbiAgICAgICAgL15odHRwcz86XFwvXFwvLiokL1xuICAgICAgXVxuICAgIH07XG4gICAgdGhpcy5tb2RlbElkID0gbW9kZWxJZDtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICB0aGlzLnByb3ZpZGVyID0gY29uZmlnLnByb3ZpZGVyO1xuICAgIHRoaXMucmVxdWVzdEJ1aWxkZXIgPSBuZXcgT2xsYW1hUmVxdWVzdEJ1aWxkZXIoKTtcbiAgICB0aGlzLnJlc3BvbnNlUHJvY2Vzc29yID0gbmV3IE9sbGFtYVJlc3BvbnNlUHJvY2Vzc29yKGNvbmZpZyk7XG4gIH1cbiAgYXN5bmMgZG9HZW5lcmF0ZShvcHRpb25zKSB7XG4gICAgY29uc3QgeyBhcmdzOiBib2R5LCB3YXJuaW5ncyB9ID0gYXdhaXQgdGhpcy5wcmVwYXJlUmVxdWVzdChvcHRpb25zKTtcbiAgICBjb25zdCB7XG4gICAgICByZXNwb25zZUhlYWRlcnMsXG4gICAgICB2YWx1ZTogcmVzcG9uc2UsXG4gICAgICByYXdWYWx1ZTogcmF3UmVzcG9uc2VcbiAgICB9ID0gYXdhaXQgcG9zdEpzb25Ub0FwaTMoe1xuICAgICAgdXJsOiB0aGlzLmNvbmZpZy51cmwoe1xuICAgICAgICBwYXRoOiBcIi9jaGF0XCIsXG4gICAgICAgIG1vZGVsSWQ6IHRoaXMubW9kZWxJZFxuICAgICAgfSksXG4gICAgICBoZWFkZXJzOiBjb21iaW5lSGVhZGVyczModGhpcy5jb25maWcuaGVhZGVycygpLCBvcHRpb25zLmhlYWRlcnMpLFxuICAgICAgYm9keTogeyAuLi5ib2R5LCBzdHJlYW06IGZhbHNlIH0sXG4gICAgICBmYWlsZWRSZXNwb25zZUhhbmRsZXI6IG9sbGFtYUZhaWxlZFJlc3BvbnNlSGFuZGxlcixcbiAgICAgIHN1Y2Nlc3NmdWxSZXNwb25zZUhhbmRsZXI6IGNyZWF0ZUpzb25SZXNwb25zZUhhbmRsZXIzKGJhc2VPbGxhbWFSZXNwb25zZVNjaGVtYTIpLFxuICAgICAgYWJvcnRTaWduYWw6IG9wdGlvbnMuYWJvcnRTaWduYWwsXG4gICAgICBmZXRjaDogdGhpcy5jb25maWcuZmV0Y2hcbiAgICB9KTtcbiAgICBjb25zdCBwcm9jZXNzZWRSZXNwb25zZSA9IHRoaXMucmVzcG9uc2VQcm9jZXNzb3IucHJvY2Vzc0dlbmVyYXRlUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgIHJldHVybiB7XG4gICAgICAuLi5wcm9jZXNzZWRSZXNwb25zZSxcbiAgICAgIHJlcXVlc3Q6IHsgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSkgfSxcbiAgICAgIHJlc3BvbnNlOiB7XG4gICAgICAgIG1vZGVsSWQ6IHRoaXMubW9kZWxJZCxcbiAgICAgICAgdGltZXN0YW1wOiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSxcbiAgICAgICAgaGVhZGVyczogcmVzcG9uc2VIZWFkZXJzLFxuICAgICAgICBib2R5OiByYXdSZXNwb25zZVxuICAgICAgfSxcbiAgICAgIHdhcm5pbmdzXG4gICAgfTtcbiAgfVxuICBhc3luYyBkb1N0cmVhbShvcHRpb25zKSB7XG4gICAgY29uc3QgeyBhcmdzOiBib2R5LCB3YXJuaW5ncyB9ID0gYXdhaXQgdGhpcy5wcmVwYXJlUmVxdWVzdChvcHRpb25zKTtcbiAgICBjb25zdCB7IHJlc3BvbnNlSGVhZGVycywgdmFsdWU6IHJlc3BvbnNlIH0gPSBhd2FpdCBwb3N0SnNvblRvQXBpMyh7XG4gICAgICB1cmw6IHRoaXMuY29uZmlnLnVybCh7XG4gICAgICAgIHBhdGg6IFwiL2NoYXRcIixcbiAgICAgICAgbW9kZWxJZDogdGhpcy5tb2RlbElkXG4gICAgICB9KSxcbiAgICAgIGhlYWRlcnM6IGNvbWJpbmVIZWFkZXJzMyh0aGlzLmNvbmZpZy5oZWFkZXJzKCksIG9wdGlvbnMuaGVhZGVycyksXG4gICAgICBib2R5OiB7IC4uLmJvZHksIHN0cmVhbTogdHJ1ZSB9LFxuICAgICAgZmFpbGVkUmVzcG9uc2VIYW5kbGVyOiBvbGxhbWFGYWlsZWRSZXNwb25zZUhhbmRsZXIsXG4gICAgICBzdWNjZXNzZnVsUmVzcG9uc2VIYW5kbGVyOiBjcmVhdGVOZGpzb25TdHJlYW1SZXNwb25zZUhhbmRsZXIoYmFzZU9sbGFtYVJlc3BvbnNlU2NoZW1hMiksXG4gICAgICBhYm9ydFNpZ25hbDogb3B0aW9ucy5hYm9ydFNpZ25hbCxcbiAgICAgIGZldGNoOiB0aGlzLmNvbmZpZy5mZXRjaFxuICAgIH0pO1xuICAgIGNvbnN0IHN0cmVhbVByb2Nlc3NvciA9IG5ldyBPbGxhbWFTdHJlYW1Qcm9jZXNzb3IodGhpcy5jb25maWcpO1xuICAgIHJldHVybiB7XG4gICAgICBzdHJlYW06IHJlc3BvbnNlLnBpcGVUaHJvdWdoKFxuICAgICAgICBzdHJlYW1Qcm9jZXNzb3IuY3JlYXRlVHJhbnNmb3JtU3RyZWFtKHdhcm5pbmdzLCBvcHRpb25zKVxuICAgICAgKSxcbiAgICAgIHJlcXVlc3Q6IHsgYm9keSB9LFxuICAgICAgcmVzcG9uc2U6IHsgaGVhZGVyczogcmVzcG9uc2VIZWFkZXJzIH0sXG4gICAgICB3YXJuaW5nc1xuICAgIH07XG4gIH1cbiAgYXN5bmMgcHJlcGFyZVJlcXVlc3Qob3B0aW9ucykge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnJlcXVlc3RCdWlsZGVyLmJ1aWxkUmVxdWVzdCh7XG4gICAgICBtb2RlbElkOiB0aGlzLm1vZGVsSWQsXG4gICAgICAuLi5vcHRpb25zXG4gICAgfSk7XG4gIH1cbn07XG5cbi8vIHNyYy9vbGxhbWEtcHJvdmlkZXIudHNcbmZ1bmN0aW9uIGNyZWF0ZU9sbGFtYShvcHRpb25zID0ge30pIHtcbiAgdmFyIF9hLCBfYjtcbiAgY29uc3QgYmFzZVVSTCA9IChfYSA9IHdpdGhvdXRUcmFpbGluZ1NsYXNoKG9wdGlvbnMuYmFzZVVSTCkpICE9IG51bGwgPyBfYSA6IFwiaHR0cDovLzEyNy4wLjAuMToxMTQzNC9hcGlcIjtcbiAgY29uc3QgcHJvdmlkZXJOYW1lID0gKF9iID0gb3B0aW9ucy5uYW1lKSAhPSBudWxsID8gX2IgOiBcIm9sbGFtYVwiO1xuICBjb25zdCBnZXRIZWFkZXJzID0gKCkgPT4gKHtcbiAgICBcIk9sbGFtYS1Pcmdhbml6YXRpb25cIjogb3B0aW9ucy5vcmdhbml6YXRpb24sXG4gICAgXCJPbGxhbWEtUHJvamVjdFwiOiBvcHRpb25zLnByb2plY3QsXG4gICAgLi4ub3B0aW9ucy5oZWFkZXJzXG4gIH0pO1xuICBjb25zdCBjcmVhdGVDb21wbGV0aW9uTW9kZWwgPSAobW9kZWxJZCwgc2V0dGluZ3MgPSB7fSkgPT4gbmV3IE9sbGFtYUNvbXBsZXRpb25MYW5ndWFnZU1vZGVsKG1vZGVsSWQsIHNldHRpbmdzLCB7XG4gICAgcHJvdmlkZXI6IGAke3Byb3ZpZGVyTmFtZX0uY29tcGxldGlvbmAsXG4gICAgdXJsOiAoeyBwYXRoIH0pID0+IGAke2Jhc2VVUkx9JHtwYXRofWAsXG4gICAgaGVhZGVyczogZ2V0SGVhZGVycyxcbiAgICBmZXRjaDogb3B0aW9ucy5mZXRjaFxuICB9KTtcbiAgY29uc3QgY3JlYXRlRW1iZWRkaW5nTW9kZWwgPSAobW9kZWxJZCwgc2V0dGluZ3MgPSB7fSkgPT4gbmV3IE9sbGFtYUVtYmVkZGluZ01vZGVsKG1vZGVsSWQsIHNldHRpbmdzLCB7XG4gICAgcHJvdmlkZXI6IGAke3Byb3ZpZGVyTmFtZX0uZW1iZWRkaW5nYCxcbiAgICB1cmw6ICh7IHBhdGggfSkgPT4gYCR7YmFzZVVSTH0ke3BhdGh9YCxcbiAgICBoZWFkZXJzOiBnZXRIZWFkZXJzLFxuICAgIGZldGNoOiBvcHRpb25zLmZldGNoXG4gIH0pO1xuICBjb25zdCBjcmVhdGVMYW5ndWFnZU1vZGVsID0gKG1vZGVsSWQpID0+IHtcbiAgICBpZiAobmV3LnRhcmdldCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIlRoZSBPbGxhbWEgbW9kZWwgZnVuY3Rpb24gY2Fubm90IGJlIGNhbGxlZCB3aXRoIHRoZSBuZXcga2V5d29yZC5cIlxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGNyZWF0ZVJlc3BvbnNlc01vZGVsKG1vZGVsSWQpO1xuICB9O1xuICBjb25zdCBjcmVhdGVSZXNwb25zZXNNb2RlbCA9IChtb2RlbElkKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBPbGxhbWFSZXNwb25zZXNMYW5ndWFnZU1vZGVsKG1vZGVsSWQsIHtcbiAgICAgIHByb3ZpZGVyOiBgJHtwcm92aWRlck5hbWV9LnJlc3BvbnNlc2AsXG4gICAgICB1cmw6ICh7IHBhdGggfSkgPT4gYCR7YmFzZVVSTH0ke3BhdGh9YCxcbiAgICAgIGhlYWRlcnM6IGdldEhlYWRlcnMsXG4gICAgICBmZXRjaDogb3B0aW9ucy5mZXRjaFxuICAgIH0pO1xuICB9O1xuICBjb25zdCBwcm92aWRlciA9IGZ1bmN0aW9uKG1vZGVsSWQpIHtcbiAgICByZXR1cm4gY3JlYXRlTGFuZ3VhZ2VNb2RlbChtb2RlbElkKTtcbiAgfTtcbiAgcHJvdmlkZXIuc3BlY2lmaWNhdGlvblZlcnNpb24gPSBcInYzXCI7XG4gIHByb3ZpZGVyLmxhbmd1YWdlTW9kZWwgPSBjcmVhdGVMYW5ndWFnZU1vZGVsO1xuICBwcm92aWRlci5jaGF0ID0gY3JlYXRlTGFuZ3VhZ2VNb2RlbDtcbiAgcHJvdmlkZXIuY29tcGxldGlvbiA9IGNyZWF0ZUNvbXBsZXRpb25Nb2RlbDtcbiAgcHJvdmlkZXIuZW1iZWRkaW5nID0gY3JlYXRlRW1iZWRkaW5nTW9kZWw7XG4gIHByb3ZpZGVyLnRleHRFbWJlZGRpbmcgPSBjcmVhdGVFbWJlZGRpbmdNb2RlbDtcbiAgcHJvdmlkZXIudGV4dEVtYmVkZGluZ01vZGVsID0gY3JlYXRlRW1iZWRkaW5nTW9kZWw7XG4gIHByb3ZpZGVyLmVtYmVkZGluZ01vZGVsID0gY3JlYXRlRW1iZWRkaW5nTW9kZWw7XG4gIHByb3ZpZGVyLmltYWdlTW9kZWwgPSAobW9kZWxJZCkgPT4ge1xuICAgIHRocm93IG5ldyBOb1N1Y2hNb2RlbEVycm9yKHtcbiAgICAgIG1vZGVsSWQsXG4gICAgICBtb2RlbFR5cGU6IFwiaW1hZ2VNb2RlbFwiLFxuICAgICAgbWVzc2FnZTogXCJJbWFnZSBnZW5lcmF0aW9uIGlzIHVuc3VwcG9ydGVkIHdpdGggT2xsYW1hXCJcbiAgICB9KTtcbiAgfTtcbiAgcmV0dXJuIHByb3ZpZGVyO1xufVxudmFyIG9sbGFtYSA9IGNyZWF0ZU9sbGFtYSgpO1xuZXhwb3J0IHtcbiAgY3JlYXRlT2xsYW1hLFxuICBvbGxhbWFcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5tanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/ollama-ai-provider-v2/dist/index.mjs\n");

/***/ })

};
;